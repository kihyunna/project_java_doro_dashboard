<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ifcWeb">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="ifcWebVO"  type="egovframework.com.sdtic.ifcrs.service.IfcWebVO" />

    <select id="ifcWebDAO.ifcWebServerAjax" parameterClass="ifcWebVO" resultClass="ifcWebVO">
        /* ifcWebServerAjax 조회 */
        SELECT AA.GUBUN,
               AA.GROUP1,
               AA.GROUP2,
               MAX(BB.INST_DATE) INST_DATE,
               MAX(BB.DISK) DISK,
               MAX(BB.CPU) CPU,
               MAX(BB.MEM) MEMORY,
               (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND CODE_LEVEL = 2) GROUP1_NAME,
               (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_NAME,
               (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND CODE_LEVEL = 2) GROUP1_ORDER,
               (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_ORDER
          FROM IOC_SDTIC_IFC_HOSTNAME AA,
               (SELECT D.HOSTNAME,
                       MAX(A.DISK) DISK,
                       MAX(A.CPU) CPU,
                       MAX(A.MEM) MEM,
                       MAX(A.INST_DATE) INST_DATE
                  FROM (SELECT REAL_HOSTNAME,
                               DISK,
                               CPU,
                               MEM,
                               INST_DATE
                          FROM IOC_SDTIC_IFC_COLCT_DATA) A,
                       (SELECT REAL_HOSTNAME, MAX(INST_DATE) MAX_INST_DATE
                          FROM IOC_SDTIC_IFC_COLCT_DATA
                         GROUP BY (REAL_HOSTNAME)) B,
                       IOC_SDTIC_IFC_HOSTNAME_COLCT C,
                       IOC_SDTIC_IFC_HOSTNAME D
                 WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
                   AND A.INST_DATE = B.MAX_INST_DATE
                   AND A.REAL_HOSTNAME = C.REAL_HOSTNAME
                   AND C.HOSTNAME = D.HOSTNAME
                   AND D.GUBUN = #gubun#
                 GROUP BY D.HOSTNAME
               ) BB
         WHERE AA.HOSTNAME = BB.HOSTNAME(+)
           AND AA.GUBUN = #gubun#
         GROUP BY GUBUN, GROUP1, GROUP2
         ORDER BY GROUP1_ORDER, GROUP2_ORDER
    </select>

    <select id="ifcWebDAO.ifcWebPrfomncAjax" parameterClass="ifcWebVO" resultClass="ifcWebVO">
        /* ifcWebPrfomncAjax 조회 */
          SELECT AA.GUBUN,
		         AA.GROUP1,
		         AA.GROUP2,
		         (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_NAME,
		         (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_ORDER,
		         SUBSTR (AA.STAT_DATE, 1, 8) YYYYMMDD,
		         SUBSTR (AA.STAT_DATE, 9, 2) HH,
		         SUM (AA.EXEC_CNT) EXEC_CNT,
		         SUM (DECODE (AA.EXEC_CNT, 0, 0, ROUND ( (AA.RESP_TIME + AA.THINK_TIME) / 10 / 1000))) AS CONCURRENT_VS,
		         ROUND (AVG (DECODE (AA.EXEC_CNT, 0, 0, AA.RESP_TIME / AA.EXEC_CNT))) AS AVG_RESP_TIME
		    FROM (SELECT D.GUBUN,
		                 D.GROUP1,
		                 D.GROUP2,
		                 A.CFG_PATH,
		                 A.STAT_DATE,
		                 A.EXEC_CNT,
		                 A.RESP_TIME,
		                 A.THINK_TIME
		            FROM SYSMSTCC.SMWS_ST_SUMMARY_S A,
		                 IOC_SDTIC_IFC_CON_NAME B,
		                 IOC_SDTIC_IFC_HOSTNAME C,
		                 IOC_SDTIC_IFC_CODE D
		           WHERE A.CFG_PATH = B.CON AND A.STAT_DATE BETWEEN TO_CHAR (SYSDATE, 'YYYYMMDD') || '000000' 
		             AND TO_CHAR (SYSDATE, 'YYYYMMDD') || '999999' 
		             AND B.HOSTNAME = C.HOSTNAME 
		             AND C.GUBUN = D.GUBUN 
		             AND C.GROUP1 = D.GROUP1 
		             AND C.GROUP2 = D.GROUP2 
		             <isNotEmpty property="gubun">
           				<![CDATA[
           				AND D.GUBUN = #gubun#
           				]]>
				     </isNotEmpty>
				     <isNotEmpty property="group1">
				        <![CDATA[
				        AND D.GROUP1 = #group1#
				        ]]>
				    </isNotEmpty>
		             ) AA
		GROUP BY AA.GUBUN,
		         AA.GROUP1,
		         AA.GROUP2,
		         SUBSTR (AA.STAT_DATE, 1, 8),
		         SUBSTR (AA.STAT_DATE, 9, 2)
		ORDER BY GROUP2_ORDER, YYYYMMDD, HH
    </select>
    
    <select id="ifcWebDAO.mainCloudWebWasAjax" parameterClass="ifcWebVO" resultClass="ifcWebVO">
        /* mainCloudWebWasAjax 조회 */
        SELECT A.GUBUN,
               A.GROUP1,
               A.GROUP2,
               A.GROUP3,
               A.CRE_DATETIME,
               A.HH_00,
               A.HH_01,
               A.HH_02,
               A.HH_03,
               A.HH_04,
               A.HH_05,
               A.HH_06,
               A.HH_07,
               A.HH_08,
               A.HH_09,
               A.HH_10,
               A.HH_11,
               A.HH_12,
               A.HH_13,
               A.HH_14,
               A.HH_15,
               A.HH_16,
               A.HH_17,
               A.HH_18,
               A.HH_19,
               A.HH_20,
               A.HH_21,
               A.HH_22,
               A.HH_23,
               A.HH_24,
               (SELECT CODE_NAME FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND CODE_LEVEL = 2 ) GROUP1_NAME,
               (SELECT CODE_NAME FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) GROUP2_NAME,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND CODE_LEVEL = 2 ) GROUP1_ORDER,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) GROUP2_ORDER,
               (SELECT CODE_NAME FROM IFC_CODE WHERE GUBUN = 'CD' AND GROUP1 = 'PRF' AND GROUP2 = A.GROUP3 ) GROUP3_NAME,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE GUBUN = 'CD' AND GROUP1 = 'PRF' AND GROUP2 = A.GROUP3 ) GROUP3_ORDER
          FROM (SELECT GUBUN,
                       GROUP1,
                       GROUP2,
                       GROUP3,
                       CRE_DATETIME,
                       HH_00,
		               HH_01,
		               HH_02,
		               HH_03,
		               HH_04,
		               HH_05,
		               HH_06,
		               HH_07,
		               HH_08,
		               HH_09,
		               HH_10,
		               HH_11,
		               HH_12,
		               HH_13,
		               HH_14,
		               HH_15,
		               HH_16,
		               HH_17,
		               HH_18,
		               HH_19,
		               HH_20,
		               HH_21,
		               HH_22,
		               HH_23,
		               HH_24
                  FROM IFC_WEB_PRFOMNC_STATE) A,
               (  SELECT GUBUN,
                         GROUP1,
                         GROUP2,
                         GROUP3,
                         MAX (CRE_DATETIME) MAX_CRE_DATETIME
                    FROM IFC_WEB_PRFOMNC_STATE
                GROUP BY (GUBUN, GROUP1, GROUP2, GROUP3)) B
         WHERE A.GUBUN = B.GUBUN
           AND A.GROUP1 = B.GROUP1
           AND A.GROUP2 = B.GROUP2
           AND A.GROUP3 = B.GROUP3
           AND A.CRE_DATETIME = B.MAX_CRE_DATETIME
       <isNotEmpty property="gubun">
           <![CDATA[
           AND A.GUBUN = #gubun#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group1">
           <![CDATA[
           AND A.GROUP1 = #group1#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group2">
           <![CDATA[
           AND A.GROUP2 = #group2#
           ]]>
       </isNotEmpty>
         ORDER BY GROUP1_ORDER, GROUP2_ORDER, GROUP3_ORDER
    </select>

</sqlMap>