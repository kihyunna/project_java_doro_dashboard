<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="bucCmmn">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="bucCmmnVO"  type="egovframework.com.sdtic.bucrs.service.BucCmmnVO" />

    <!-- 비즈니스 공통 기술자문 처리실적 쿼리 -->
   	<select id="bucResearchinfoDAO.bucCmmnTechAdvPrcssdbAjax" parameterClass="bucCmmnVO" resultClass="bucCmmnVO">
		/**************************************************************************************************
		     01. 교통 realm_01_cnt
		     02. 구조 realm_02_cnt
		     03. 지반 realm_03_cnt
		     04. 사면 realm_04_cnt
		     05. 재료환경 realm_05_cnt
		     06. 포장 realm_06_cnt
		     07. 기타 realm_07_cnt
		     08. 경영 realm_08_cnt
		     00. 수행중 realm_00_cnt 
		 *************************************************************************************************/     
		
		
		SELECT CNSUT_REALM_NM
		       ,COUNT(CASE WHEN CNSUT_REALM = CNSUT_REALM THEN  1 END) AS REALM_01_CNT /*전체*/
		       ,COUNT(CASE WHEN CNSUT_REALM = CNSUT_REALM AND PROCESS_STTUS = '03' THEN  1 END) AS REALM_01_CNT1 /*수행중*/
		       ,COUNT(CASE WHEN CNSUT_REALM = CNSUT_REALM AND PROCESS_STTUS = '04' THEN  1 END) AS REALM_01_CNT2 /*결과등록*/
		       ,COUNT(CASE WHEN CNSUT_REALM = CNSUT_REALM AND PROCESS_STTUS = '05' THEN  1 END) AS REALM_01_CNT3 /*완료*/
		
		    FROM(
		    SELECT TECH_CNSUT_CODE,
		           ACMSLT_ID,
		           TECH_CNSUT_NM,
		           EXC_SE,
		           ISE_EXTRL_SE,
		           CNSUT_NO,
		           REQEST_OFFIC,
		           REQEST_OFFIC_NM,
		           REQEST_OFLDC_NO,
		           REQEST_DE,
		           PROCESS_STTUS,
		           PCHRG_AT,
		           (SELECT CODE_NM
		              FROM CYL_CMM_0002_TC
		             WHERE CODE_ID = 'CYLCNSL002'
		               AND CODE = PROCESS_STTUS) STATUS,
		           (SELECT CODE_NM
		                  FROM CYL_CMM_0002_TC
		                 WHERE CODE_ID = 'CYLCNSL005' AND CODE = CNSUT_REALM) CNSUT_REALM_NM,
		           CRTE_USER_ID,
		           CRTE_DTTM,
		           CNSUT_BGNDE,
		           CNSUT_ENDDE,
		           PROCESS_COMPT_DE,
		           CNSUT_REALM
		      FROM CYL_PMS_1602_TN 
		     WHERE PROCESS_STTUS IN ('03', '04', '05')
		       AND REQEST_DE BETWEEN TO_CHAR(sysdate, 'YYYYMM') || '01' AND TO_CHAR(sysdate, 'YYYYMM') || '31'
		       AND EXC_SE = 'TC'
		    ) A
		    
		GROUP BY CNSUT_REALM_NM   		
    </select>
</sqlMap>