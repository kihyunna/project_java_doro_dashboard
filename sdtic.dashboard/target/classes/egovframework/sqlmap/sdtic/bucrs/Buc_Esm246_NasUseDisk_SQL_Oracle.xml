<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="bucNasUseDiskDAO">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="bucParamEsmVO"  type="egovframework.com.sdtic.bucrs.service.BucParamEsmVO" />
    <typeAlias  alias="bucCollectEsmVO"  type="egovframework.com.sdtic.bucrs.service.BucCollectEsmVO" />

    <select id="bucEsm246NasUseDiskDAO.bucCollectEsm246NasUseDiskAjax" parameterClass="bucParamEsmVO" resultClass="BucCollectEsmVO">
        /* bucCollectNasUseDiskAjax 조회 */
        <![CDATA[
        SELECT AA.AGENT_IP HOSTNAME,
              AA.NAME AS OBJ_NAME,
              'DISK' AS RSCTYPE_ID,
              DD.NAME AS RSC_KEY_NAME,
              CEIL (MAX(DD.V3)) RESULTVALUE_DOUBLE,
              TO_CHAR (MAX(DD.EVENT_TIME), 'YYYYMMDDhh24miss') COLLECT_DATE
        FROM (SELECT AGENT_IP , NAME
              FROM AGENT_INFO_LIST
              WHERE AGENT_IP IN ($realhostname$)) AA,
             (SELECT A.ORIGIN,
                     A.NAME,
                     MAX (A.V3) V3,
                     SUM (A.V5) V5,
                     MAX (A.EVENT_TIME) EVENT_TIME
                FROM (SELECT ORIGIN,
                             NAME,
                             V3,
                             V5,
                             EVENT_TIME
                        FROM R_$yyyymmdd$
                       WHERE EVENT_TIME > To_DATE($yyyymmdd$||'235959','YYYYMMDDhh24miss') -1/24/6
                         AND CATEGORY = 'R002'
                         AND NAME LIKE '%nas%') A
                GROUP BY A.ORIGIN, A.NAME) DD
         WHERE AA.AGENT_IP = DD.ORIGIN
         GROUP BY AA.AGENT_IP, AA.NAME , DD.NAME
		]]>
    </select>

</sqlMap>