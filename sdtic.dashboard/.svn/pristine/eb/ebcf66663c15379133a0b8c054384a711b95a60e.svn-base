<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ifcSpt">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="ifcSptVO"  type="egovframework.com.sdtic.ifcrs.service.IfcSptVO" />

    <select id="ifcSptDAO.ifcSptServerAjax" parameterClass="ifcSptVO" resultClass="ifcSptVO">
        /* ifcSptServerAjax 조회 */
        SELECT A.GUBUN,
               A.GROUP1,
               A.GROUP2,
               A.CRE_DATETIME,
               A.CPU_TOTAL_CNT,
               A.CPU_CAUTION_CNT,
               A.CPU_DANGER_CNT,
               A.MEMORY_TOTAL_CNT,
               A.MEMORY_CAUTION_CNT,
               A.MEMORY_DANGER_CNT,
               A.DISK_TOTAL_CNT,
               A.DISK_CAUTION_CNT,
               A.DISK_DANGER_CNT,
               A.PROCESS_TOTAL_CNT,
               A.PROCESS_CAUTION_CNT,
               A.PROCESS_DANGER_CNT,
               (SELECT CODE_NAME FROM IFC_CODE WHERE A.GUBUN = GUBUN AND A.GROUP1 = GROUP1 AND A.GROUP2 = GROUP2 ) CODE_NAME,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE A.GUBUN = GUBUN AND A.GROUP1 = GROUP1 AND A.GROUP2 = GROUP2 ) CODE_ORDER
          FROM (SELECT GUBUN,
                       GROUP1,
                       GROUP2,
                       CRE_DATETIME,
                       CPU_TOTAL_CNT,
		               CPU_CAUTION_CNT,
		               CPU_DANGER_CNT,
		               MEMORY_TOTAL_CNT,
		               MEMORY_CAUTION_CNT,
		               MEMORY_DANGER_CNT,
		               DISK_TOTAL_CNT,
		               DISK_CAUTION_CNT,
		               DISK_DANGER_CNT,
		               PROCESS_TOTAL_CNT,
                       PROCESS_CAUTION_CNT,
                       PROCESS_DANGER_CNT
                  FROM IFC_SPT_STATE) A,
               (  SELECT GUBUN,
                         GROUP1,
                         GROUP2,
                         MAX (CRE_DATETIME) MAX_CRE_DATETIME
                    FROM IFC_SPT_STATE
                GROUP BY (GUBUN, GROUP1, GROUP2)) B
         WHERE A.GUBUN = B.GUBUN
           AND A.GROUP1 = B.GROUP1
           AND A.GROUP2 = B.GROUP2
           AND A.CRE_DATETIME = B.MAX_CRE_DATETIME
       <isNotEmpty property="gubun">
           <![CDATA[
           AND A.GUBUN = #gubun#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group1">
           <![CDATA[
           AND A.GROUP1 = #group1#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group2">
           <![CDATA[
           AND A.GROUP2 = #group2#
           ]]>
       </isNotEmpty>
         ORDER BY CODE_ORDER
    </select>

</sqlMap>