<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c"       uri="http://java.sun.com/jsp/jstl/core"                     %>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv='description' content='' />
<title>기술자문 처리 실적</title>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script type="text/javascript" src="${contextPath}/js/echarts/dist/echarts.min.js"></script>
<script type="text/javascript" src="${contextPath}/js/common/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="${contextPath}/js/echarts/theme/dark.js"></script>
<link rel="stylesheet" type="text/css" href="${contextPath}/css/main/default.css" />


<script type="text/javascript">

    </script>
</head>
<style type="text/css">
    #grid1{position:absolute;top:22px; left:10px;font-color:#fff;font-family:"nanum", "Nanum Gothic", "NanumGothic", "나눔고딕", "돋움", "Dotum", Arial, AppleGothic, Sans-Serif;font-weight:normal;}
</style>

<body>

 <div id="main" style="width:700px; height:400px;" ></div>
    <script type="text/javascript">
	    
	    jQuery(document).ready(function($){

	    	//-----------------------------------AJAX 호출 영역 ---------------------------------------

	    	        getBucCmmnTechAdvPrcssdbAjax();
	    	        setDivHeight('main');

	    	//-----------------------------------AJAX 호출 영역 ---------------------------------------
	    })

	    function getBucCmmnTechAdvPrcssdbAjax(){
	        $.ajax({
	            url : "${pageContext.request.contextPath}/buc/bucCmmnTechAdvPrcssdbAjax.do",
	            async : false,
	            dataType : 'json',
	            success :function(json) {
	            	if(json.data.length > 0) {
	            		for(var i = 0; i<json.data.length; i++) {
	            			completeData[0] = parseInt(json.data[i].realm_01_cnt);
	            			completeData[1] = parseInt(json.data[i].realm_02_cnt);
	            			completeData[2] = parseInt(json.data[i].realm_03_cnt);
	            			completeData[3] = parseInt(json.data[i].realm_04_cnt);
	            			completeData[4] = parseInt(json.data[i].realm_05_cnt);
	            			completeData[5] = parseInt(json.data[i].realm_06_cnt);
	            			completeData[6] = parseInt(json.data[i].realm_07_cnt);
	            			completeData[7] = parseInt(json.data[i].realm_08_cnt);
	            			completeData[8] = parseInt(json.data[i].realm_09_cnt);
	            			
	            			totalData[0] = parseInt(json.data[i].realm_01_cnt2);
	            			totalData[1] = parseInt(json.data[i].realm_02_cnt2);
	            			totalData[2] = parseInt(json.data[i].realm_03_cnt2);
	            			totalData[3] = parseInt(json.data[i].realm_04_cnt2);
	            			totalData[4] = parseInt(json.data[i].realm_05_cnt2);
	            			totalData[5] = parseInt(json.data[i].realm_06_cnt2);
	            			totalData[6] = parseInt(json.data[i].realm_07_cnt2);
	            			totalData[7] = parseInt(json.data[i].realm_08_cnt2);
	            			totalData[8] = parseInt(json.data[i].realm_09_cnt2);
	            		}
	            		
	            		for(var j = 0; j<completeData.length; j++) {
	            			minusData[j] = totalData[j] - completeData[j];
	            		}
	            	}
	            },error : function(){
	               console.log(arguments);
	            }, complete : function() {
	                myChart.setOption(option);
	            }
	        });		
	    }
 
        var myChart = echarts.init(document.getElementById('main'),'dark');
		
        var xAxisData = ['교통', '구조', '지반', '사면', '재료환경', '포장', '기타', '경영', '수행중'];
        
        var completeData = [20, 30, 40, 30, 20, 40, 50, 60, 70];
        var totalData = [100, 120, 110, 130, 140, 150, 160, 170, 100];
        var minusData = [80, 90, 70, 100, 120, 110, 110, 110, 30];

        option = {
        	    legend: {
        	        data: ['완료', '전체']
        	    },
        	    grid: {
        	        left: '3%',
        	        right: '4%',
        	        bottom: '3%',
        	        containLabel: true
        	    },
        	    yAxis:  {
        	        type: 'value'
        	    },
        	    xAxis: {
        	        type: 'category',
        	        data: xAxisData
        	    },
        	    series: [
        	        {
        	            name: '완료',
        	            type: 'bar',
        	            stack: 'a',
        	            label: {
        	                normal: {
        	                    show: true,
        	                    position: 'insideTop'
        	                }
        	            },
        	            data: completeData
        	        },
        	        {
        	            name: '전체',
        	            type: 'bar',
        	            stack: 'a',
        	            label: {
        	                normal: {
        	                    show: true,
        	                    formatter:function(v) {
        	                    	return totalData[v.dataIndex];
        	                    },
        	                    position: 'insideTop'
        	                }
        	            },
        	            data: minusData
        	        }
        	    ]
        	};

        myChart.setOption(option);


        $(window).resize(function(){

            setDivHeight('main');

        });

        function setDivHeight(objSet)
        {

            var objSet   = document.getElementById(objSet);
            objSet.style.width  = ($(window).width()) + "px";
            objSet.style.height  = ($(window).height()) + "px";


            $('#main').width(($(window).width()) + "px");
            $('#main').height(($(window).height()) + "px");


            myChart.resize({
                width: $(window).width(),
                height : $(window).height()
            });
            myChart.setOption(option);
        }

    </script>
</body>
</html>