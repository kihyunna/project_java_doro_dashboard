<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="fecTotlInsrTotDAO">
	<typeAlias  alias="fecSlpVO"  type="egovframework.com.sdtic.fecrs.service.fecSlpVO" />
	<typeAlias  alias="fecCctvVO"  type="egovframework.com.sdtic.fecrs.service.fecCctvVO" />
	<typeAlias  alias="fecEventVO"  type="egovframework.com.sdtic.fecrs.service.fecEventVO" />
    <typeAlias  alias="FecSearchVO"  type="egovframework.com.sdtic.fecrs.service.FecSearchVO" />
    <typeAlias  alias="FecSptMapVO"  type="egovframework.com.sdtic.fecrs.service.FecSptMapVO" />
    <typeAlias  alias="FecMDTOperVO"  type="egovframework.com.sdtic.fecrs.service.FecMDTOperVO" />
    
    <select id="fecTotlInsrTotDAO.fecGetSlp" resultClass="fecSlpVO">  
	    SELECT a.msis_gtwy_id,
	    	   a.fclts_intg_id,
		       b.msis_snsr_id,
		       a.pbus_jrsd_hdqr_cd hdqr_cd,
		       a.hdqr_nm,
		       a.pbus_jrsd_mtnof_cd mtnof_cd,
		       a.mtnof_nm,
		       a.pbus_route_cd,
		       a.use_rotnm,
		       a.regin_nm,
		       a.pbus_stpnt_dstnc,
		       a.drve_drnm,
		       a.pbus_drve_drct_cd,
		       a.ggtm_xcord,
		       a.ggtm_ycord
		  FROM T_EXMF_MSIS_MGMT01M1 a, T_EXMF_SNSR_MGMT01M1 b
		 WHERE a.MSIS_GTWY_ID = b.MSIS_GTWY_ID AND a.USE_YN = 'Y'
    </select> 
    
    <select id="fecTotlInsrTotDAO.fecGetTroblSlp" resultClass="fecSlpVO">  
		SELECT msis_gtwy_id,
		       msis_snsr_id,
		       trobl_type,
		       use_yn,
		       to_char (fsttm_rgst_dttm, 'yyyymmddhh24miss') fsttm_rgst_dttm,
		       to_char (lsttm_altr_dttm, 'yyyymmddhh24miss') lsttm_altr_dttm
		  FROM (  SELECT MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 '1' AS trobl_type,
		                 use_yn,
		                 FSTTM_RGST_DTTM,
		                 MAX (LSTTM_ALTR_DTTM) LSTTM_ALTR_DTTM
		            FROM T_EXMF_SNSR_SHCK_AMNT01M1
		           WHERE     1 = 1
		                 AND MSIS_ALRM_ID  <![CDATA[  <>  ]]>  '0'
		                 AND LSTTM_ALTR_DTTM >=
		                        TO_DATE (to_char(sysdate, 'yyyymmdd')||'000000', 'yyyymmddhh24miss')
		        GROUP BY MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 use_yn,
		                 FSTTM_RGST_DTTM
		        UNION ALL
		          SELECT MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 '2' AS trobl_type,
		                 use_yn,
		                 FSTTM_RGST_DTTM,
		                 MAX (LSTTM_ALTR_DTTM) LSTTM_ALTR_DTTM
		            FROM T_EXMF_SNSR_BTRY_STAT01M1
		           WHERE     1 = 1
		                 AND MSIS_ALRM_ID <![CDATA[  <>  ]]> '0'
		                 AND LSTTM_ALTR_DTTM >=
		                        TO_DATE (to_char(sysdate, 'yyyymmdd')||'000000', 'yyyymmddhh24miss')
		        GROUP BY MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 use_yn,
		                 FSTTM_RGST_DTTM)
    </select>  
    
    <select id="fecTotlInsrTotDAO.fecGetEventSlp" parameterClass="String" resultClass="fecSlpVO">  
				SELECT msis_idx_seq,
				       msis_gtwy_id,
				       msis_snsr_id,
				       msis_ntfc_kind_cd,
				       to_char (fsttm_rgst_dttm, 'yyyymmddhh24miss') fsttm_rgst_dttm,
		       		   to_char (lsttm_altr_dttm, 'yyyymmddhh24miss') lsttm_altr_dttm,
				       use_yn
				  FROM T_EXMF_SNSR_ALRM01M1
				 WHERE     LSTTM_ALTR_DTTM <![CDATA[  >=  ]]> TO_DATE (to_char(sysdate, 'yyyymmdd')||'000000', 'yyyymmddhh24miss')
				       AND MSIS_IDX_SEQ <![CDATA[  >  ]]> #msis_idx_seq#
    </select> 
    
    <select id="fecTotlInsrTotDAO.checkCCTV" parameterClass="String" resultClass="fecCctvVO">  
				select spin_intg_id,spin_intg_nm,data_id,hdqr_cd,mtnof_cd,route_cd,route_drct_cd,insl_dstnc,ggtm_xcord,ggtm_ycord
				from V_EXMD_SPIN_HIWAY_CCTV01L1
				where hdqr_cd = #hdqr_cd#
				order by HDQR_CD,MTNOF_CD
    </select> 
    
    <select id="fecTotlInsrTotDAO.fecGetEventMdtAjax" parameterClass="FecSearchVO" resultClass="fecEventVO">  
		select  d.HDQR_NM hdqr_nm, e.MTNOF_NM mtnof_nm, b.MGMT_DPTCD mtnof_cd,  a.GRS80_XCORD as xcord, a.GRS80_YCORD as ycord , 3 coord_type, 2 recover, b.MDT_INSR_MODL_CD||' '|| b.INSR_MODL_NM||' 수신율 '|| c.grade as content,
		b.RGST_SEQ fclts_name,  to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss') event_time , c.grade grade
		from T_EXMB_VHCL_CRDN01L1 a,
		T_EXMB_TRMLT01I1 b,
		(select 100 as grade from
		dual) c,
		T_CNKC_HDQR01M1 d,
		T_CNKC_MTNOF01M1 e
		where 1=1
		and e.MTNOF_CD = b.MGMT_DPTCD
		and e.HDQR_CD = d.HDQR_CD
		and a.OPND_NO = b.OPND_NO
		/*조건문 수정*/
		and a.LSTTM_ALTR_DTTM <![CDATA[  <   ]]> (sysdate - 12/24/60/60)
		/*and c.OPND_NO = a.OPND_NO*/
		/*조건문 수정*/
		and b.MGMT_DPTCD = #deptCode# 
    </select>    
    
    <select id="fecTotlInsrTotDAO.mainSptSensorMdt" resultClass="java.util.HashMap">  
		select 'mdt' as name, max(troblCnt) as troblCnt , max(totalCnt) as totalCnt
		from( 
			select sum(1) as troblCnt, 0 as totalCnt from T_EXMB_TRMLT01I1 a, T_EXMB_VHCL_CRDN01L1 b
			where a.USE_YN = 'Y'
			and b.USE_YN = 'Y'
			and a.HGRN_DPTCD in ('N01795','N01796','N02723','N01797','N01798','N01799','N01800','N01801')
			and a.opnd_no = b.opnd_no
			/*조건문 변경*/
			and a.LSTTM_ALTR_DTTM  <![CDATA[  >   ]]>   (sysdate - 12/60)
			/*조건문 변경*/
			union all
			select 0 as troblCnt, sum(1) as totalCnt from T_EXMB_TRMLT01I1
			where USE_YN = 'Y'
			and HGRN_DPTCD in ('N01795','N01796','N02723','N01797','N01798','N01799','N01800','N01801')
		)
    </select>
    
    <select id="fecTotlInsrTotDAO.fecSptMapMdtAjax" parameterClass="FecSearchVO" resultClass="FecSptMapVO">  
			select 'mdt' as name, HGRN_DPTCD as deptCode, count(*) as CNT from T_EXMB_TRMLT01I1
			where USE_YN = 'Y'
			and HGRN_DPTCD = #deptCode#
			group by HGRN_DPTCD
    </select>
    
    <select id="fecTotlInsrTotDAO.fecMdtoperLv1Ajax" parameterClass="FecSearchVO" resultClass="FecMDTOperVO">  
	    select dept_code as deptCode, dept_nm as deptNm , nrmlt_today as nrmltToday, warn_today as warnToday,
	           trobl_today as troblToday, nrmlt_bfrt as nrmltBfrt, warn_bfrt as warnBfrt, trobl_bfrt as troblBfrt
		from   fec_mdt_oper
		where dept_code = #deptCode#      
    </select>  
    
    <select id="fecTotlInsrTotDAO.fecMdttroblLv1Ajax" parameterClass="FecSearchVO" resultClass="FecMDTOperVO">  
	    select dept_code as deptCode, dept_nm as deptNm , mdt_id as mdtId, mdt_opert as mdtOpert, mdt_last_lc as mdtLastLc
		from   fec_mdt_trobl
		where dept_code = #deptCode#      
    </select> 
    
    <select id="fecTotlInsrTotDAO.fecMdtmapLv1Ajax" parameterClass="FecSearchVO" resultClass="FecMDTOperVO">  
	    select dept_code as deptCode, dept_nm as deptNm , recptn_ratio as recptnRatio, lon as lon, lat as lat, 
	    jisa_code as jisaCode, jisa_nm as jisaNm, jisa_lon as jisaLon, jisa_lat as jisaLat, mdt_id as mdtId
		from   fec_mdt_lc
		where dept_code = #deptCode#      
    </select> 
    
    
</sqlMap>