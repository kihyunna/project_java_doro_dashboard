<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ifcSpt">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="ifcSptVO"  type="egovframework.com.sdtic.ifcrs.service.IfcSptVO" />
    
    <select id="ifcSptDAO.ifcSptElcServerAjax" parameterClass="ifcSptVO" resultClass="ifcSptVO">
        /* ifcSptElcServerAjax 조회 */
        SELECT GROUP1,
	           GROUP2,
	           IP,
	           OS,
	           GROUP1_NAME,
	           GROUP2_NAME
	      FROM IOC_SDTIC_IFC_SPT_CODE
	     ORDER BY GROUP1, GROUP2, IP
    </select>
    
    <insert id="ifcSptDAO.ifcAddSptColctAjax" parameterClass="ifcSptVO">
      	<![CDATA[
        /* ifcAddSptColctAjax 입력 */
        INSERT INTO IOC_SDTIC_IFC_SPT_COLCT_DATA
        (
             COLCTSEQ,
			 GUBUN,
			 GROUP1,
			 GROUP2,
			 CPU,
			 MEMORY,
			 DISK,
			 PROCESS,
			 GROUP1_NAME,
			 GROUP2_NAME,
			 INST_DATE,
			 CRE_DATE
        )
        VALUES
        (
             SPT_COLCTSEQ.NEXTVAL,
             #gubun#,
			 #group1#,
			 #group2#,
			 #cpu#,
			 #memory#,
			 #disk#,
			 #process#,
			 #group1_name#,
			 #group2_name#,
			 #inst_date#,
			 TO_CHAR(sysdate, 'YYYYMMDDhh24miss')
        )
       ]]>
    </insert>
    
    <select id="ifcSptDAO.ifcSptServerAjax" parameterClass="ifcSptVO" resultClass="ifcSptVO">
        /* ifcSptServerAjax 조회 */
        SELECT GUBUN,
		       GROUP1,
		       GROUP2,
		       CPU,
		       MEMORY,
		       DISK,
		       DECODE(GROUP1_NAME, 
		       	      '대전충남본부', '충남본부',
		       	      '광주전남본부', '전남본부',
		       	      '대구경북본부', '경북본부',
		       	      '부산경남본부', '경남본부',
		       		  GROUP1_NAME) GROUP1_NAME,
		       DECODE(GROUP2_NAME, 
		       	      '대전충남본부', '충남본부',
		       	      '광주전남본부', '전남본부',
		       	      '대구경북본부', '경북본부',
		       	      '부산경남본부', '경남본부',
		       		  GROUP2_NAME) GROUP2_NAME,
		       INST_DATE
		  FROM (  SELECT 'SPT' GUBUN,
				         'ALL' GROUP1,
				         A.GROUP1 GROUP2,
				         MAX (A.CPU) CPU,
				         MAX (A.MEMORY) MEMORY,
				         MAX (A.DISK) DISK,
				         '전체' GROUP1_NAME,
				         MAX (A.GROUP1_NAME) GROUP2_NAME,
				         MAX (A.INST_DATE) INST_DATE
				    FROM (SELECT GROUP1,
				                 GROUP2,
				                 CPU,
				                 MEMORY,
				                 DISK,
				                 GROUP1_NAME,
				                 GROUP2_NAME,
				                 INST_DATE
				            FROM IOC_SDTIC_IFC_SPT_COLCT_DATA) A,
				         (  SELECT GROUP1, GROUP2, MAX (INST_DATE) MAX_INST_DATE
				              FROM IOC_SDTIC_IFC_SPT_COLCT_DATA
				          GROUP BY GROUP1, GROUP2) B
				   WHERE A.INST_DATE = B.MAX_INST_DATE
				GROUP BY A.GROUP1
				ORDER BY GROUP1, GROUP2)
		        
		UNION ALL
		
		SELECT GUBUN,
		       GROUP1,
		       GROUP2,
		       CPU,
		       MEMORY,
		       DISK,
		       DECODE(GROUP1_NAME, 
		       	      '대전충남본부', '충남본부',
		       	      '광주전남본부', '전남본부',
		       	      '대구경북본부', '경북본부',
		       	      '부산경남본부', '경남본부',
		       		  GROUP1_NAME) GROUP1_NAME,
		       DECODE(GROUP2_NAME, 
		       	      '대전충남본부', '충남본부',
		       	      '광주전남본부', '전남본부',
		       	      '대구경북본부', '경북본부',
		       	      '부산경남본부', '경남본부',
		       		  GROUP2_NAME) GROUP2_NAME,
		       INST_DATE
		 FROM (  SELECT 'SPT' GUBUN,
				         A.GROUP1,
				         A.GROUP2,
				         MAX (TO_NUMBER(A.CPU)) CPU,
				         MAX (TO_NUMBER(A.MEMORY)) MEMORY,
				         MAX (TO_NUMBER(A.DISK)) DISK,
				         MAX (GROUP1_NAME) GROUP1_NAME,
				         MAX (GROUP2_NAME) GROUP2_NAME,
				         MAX (A.INST_DATE) INST_DATE
				    FROM (SELECT GROUP1,
				                 GROUP2,
				                 CPU,
				                 MEMORY,
				                 DISK,
				                 GROUP1_NAME,
				                 GROUP2_NAME,
				                 INST_DATE
				            FROM IOC_SDTIC_IFC_SPT_COLCT_DATA) A,
				         (  SELECT GROUP1, GROUP2, MAX (INST_DATE) MAX_INST_DATE
				              FROM IOC_SDTIC_IFC_SPT_COLCT_DATA
				          GROUP BY GROUP1, GROUP2) B
				   WHERE A.INST_DATE = B.MAX_INST_DATE
				GROUP BY A.GROUP1, A.GROUP2
				ORDER BY GROUP1, GROUP2)
    </select>
    
    <select id="ifcSptDAO.mainSptRelayAjax" parameterClass="ifcSptVO" resultClass="ifcSptVO">
        /* mainSptRelayAjax 조회 */
          SELECT GUBUN,
		         GROUP1,
		         GROUP2,
		         DECODE(GROUP1_NAME, 
		       	        '대전충남본부', '충남본부',
		       	        '광주전남본부', '전남본부',
		       	        '대구경북본부', '경북본부',
		       	        '부산경남본부', '경남본부',
		       		    GROUP1_NAME) GROUP1_NAME,
		         DECODE(GROUP2_NAME, 
		       	        '대전충남본부', '충남본부',
		       	        '광주전남본부', '전남본부',
		       	        '대구경북본부', '경북본부',
		       	        '부산경남본부', '경남본부',
		       		    GROUP2_NAME) GROUP2_NAME,
		         DANGER_CNT,
		         TOTAL_CNT,
		         (TOTAL_CNT - DANGER_CNT) NORMAL_CNT,
		         INST_DATE
		    FROM (  SELECT 'SPT' GUBUN,
		                   'ALL' GROUP1,
		                   AA.GROUP1 GROUP2,
		                   CASE
		                      WHEN MAX (AA.CPU) > TO_NUMBER(#cpu_limit#) THEN 1
		                      WHEN MAX (AA.MEMORY) > TO_NUMBER(#mem_limit#) THEN 1
		                      WHEN MAX (AA.DISK) > TO_NUMBER(#disk_limit#) THEN 1
		                      WHEN MAX (AA.PROCESS) = '0' THEN 1
		                      ELSE 0
		                   END
		                      DANGER_CNT,
		                   COUNT (AA.GROUP2) TOTAL_CNT,
		                   '전체' GROUP1_NAME,
		                   MAX (AA.GROUP1_NAME) GROUP2_NAME,
		                   MAX (AA.INST_DATE) INST_DATE
		              FROM (  SELECT A.GROUP1,
		                             A.GROUP2,
		                             MAX (A.CPU) CPU,
		                             MAX (A.MEMORY) MEMORY,
		                             MAX (A.DISK) DISK,
		                             MAX (A.PROCESS) PROCESS,
		                             MAX (A.GROUP1_NAME) GROUP1_NAME,
		                             MAX (A.GROUP2_NAME) GROUP2_NAME,
		                             MAX (A.INST_DATE) INST_DATE
		                        FROM (SELECT GROUP1,
		                                     GROUP2,
		                                     CPU,
		                                     MEMORY,
		                                     DISK,
		                                     PROCESS,
		                                     GROUP1_NAME,
		                                     GROUP2_NAME,
		                                     INST_DATE
		                                FROM IOC_SDTIC_IFC_SPT_COLCT_DATA) A,
		                             (  SELECT GROUP1, GROUP2, MAX (INST_DATE) MAX_INST_DATE
		                                  FROM IOC_SDTIC_IFC_SPT_COLCT_DATA
		                              GROUP BY GROUP1, GROUP2) B
		                       WHERE A.INST_DATE = B.MAX_INST_DATE
		                    GROUP BY A.GROUP1, A.GROUP2) AA
		          GROUP BY AA.GROUP1)
		ORDER BY GROUP1, GROUP2
    </select>

</sqlMap>