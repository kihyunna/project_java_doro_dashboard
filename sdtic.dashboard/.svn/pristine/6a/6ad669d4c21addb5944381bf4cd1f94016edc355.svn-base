<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ifcMain">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="ifcMainVO"  type="egovframework.com.sdtic.ifcrs.service.IfcMainVO" />

    <select id="ifcMainDAO.ifcMainServerAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainServerAjax 조회 */
        SELECT A.GUBUN,
               A.GROUP1,
               A.GROUP2,
               A.CRE_DATETIME,
               A.DISK,
               A.CPU,
               A.MEMORY,
               (SELECT CODE_NAME FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND CODE_LEVEL = 2 ) GROUP1_NAME,
               (SELECT CODE_NAME FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) GROUP2_NAME,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND CODE_LEVEL = 2 ) GROUP1_ORDER,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) GROUP2_ORDER
          FROM (SELECT GUBUN,
                       GROUP1,
                       GROUP2,
                       CRE_DATETIME,
                       DISK,
                       CPU,
                       MEMORY
                  FROM IFC_SERVER_STATE) A,
               (  SELECT GUBUN,
                         GROUP1,
                         GROUP2,
                         MAX (CRE_DATETIME) MAX_CRE_DATETIME
                    FROM IFC_SERVER_STATE
                GROUP BY (GUBUN, GROUP1, GROUP2)) B
         WHERE A.GUBUN = B.GUBUN
           AND A.GROUP1 = B.GROUP1
           AND A.GROUP2 = B.GROUP2
           AND A.CRE_DATETIME = B.MAX_CRE_DATETIME
       <isNotEmpty property="gubun">
           <![CDATA[
           AND A.GUBUN = #gubun#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group1">
           <![CDATA[
           AND A.GROUP1 = #group1#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group2">
           <![CDATA[
           AND A.GROUP2 = #group2#
           ]]>
       </isNotEmpty>
         ORDER BY GUBUN, GROUP1_ORDER, GROUP2_ORDER
    </select>
    
    <select id="ifcMainDAO.ifcMainEventListAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainEventListAjax 조회 */
        SELECT A.TROBLSEQ,
		       A.JOBSE,
		       A.TROBLCOLCTSE,
		       A.DETAILCLSE,
		       B.HOSTNAME,
		       A.REAL_HOSTNAME,
		       A.TROBLGRADSE,
		       DECODE(A.TROBLPROCESSSTTUS,'0','발생','1','SMS발송','2','상황완료') TROBLPROCESSSTTUS,
		       A.TROBLCN,
		       A.RM,
		       SUBSTR(A.INST_DATE,0,4) || '.' || SUBSTR(A.INST_DATE,5,2) || '.' || SUBSTR(A.INST_DATE,7,2) || ' ' || 
         	   SUBSTR(A.INST_DATE,9,2) || ':' || SUBSTR(A.INST_DATE,11,2) || ':' || SUBSTR(A.INST_DATE,13,2) INST_DATE
		  FROM IOC_SDTIC_TROBL_COLCT_DATA A,
		       (SELECT REAL_HOSTNAME, 
		               MAX(HOSTNAME) HOSTNAME 
		          FROM IOC_SDTIC_IFC_HOSTNAME_COLCT 
                 WHERE 1=1
                <isNotEmpty property="hostname">
			       <![CDATA[
			       AND HOSTNAME = #hostname#
			       ]]>
			    </isNotEmpty>
                 GROUP BY REAL_HOSTNAME) B
		 WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
	    <isNotEmpty property="rownum">
	       <![CDATA[
	       AND ROWNUM <= #rownum#
	       ]]>
	    </isNotEmpty>
         ORDER BY A.INST_DATE DESC
    </select>
    
    <select id="ifcMainDAO.ifcMainDbDpmAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainDbDpmAjax 조회 */
        SELECT A.GUBUN,
               A.GROUP1,
               A.GROUP2,
               A.CRE_DATETIME,
               A.TOTAL_SESSION,
               A.ACTIVE_SESSION,
               A.LOCK_SESSION,
               (SELECT CODE_NAME FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) CODE_NAME,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) CODE_ORDER
          FROM (SELECT GUBUN,
                       GROUP1,
                       GROUP2,
                       CRE_DATETIME,
                       TOTAL_SESSION,
                       ACTIVE_SESSION,
                       LOCK_SESSION
                  FROM IFC_DPM_STATE) A,
               (  SELECT GUBUN,
                         GROUP1,
                         GROUP2,
                         MAX (CRE_DATETIME) MAX_CRE_DATETIME
                    FROM IFC_DPM_STATE
                GROUP BY (GUBUN, GROUP1, GROUP2)) B
         WHERE A.GUBUN = B.GUBUN
           AND A.GROUP1 = B.GROUP1
           AND A.GROUP2 = B.GROUP2
           AND A.CRE_DATETIME = B.MAX_CRE_DATETIME
       <isNotEmpty property="gubun">
           <![CDATA[
           AND A.GUBUN = #gubun#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group1">
           <![CDATA[
           AND A.GROUP1 = #group1#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group2">
           <![CDATA[
           AND A.GROUP2 = #group2#
           ]]>
       </isNotEmpty>
         ORDER BY CODE_ORDER
    </select>
    
    <select id="ifcMainDAO.ifcMainLimitAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainLimitAjax 조회 */
        SELECT A.MANAGESEQ,
		       A.DETAILCLSE,
		       A.TROBLGRADSE,
		       A.TROBLCOLCTSE,
		       A.THRHLD,
		       A.COLCTCYCLE,
		       A.USE_YN,
		       A.USER_SEQ
		  FROM IOC_SDTIC_EVENT_COLCT_CYCLE A
		 WHERE A.USE_YN = 'Y'
		   AND A.TROBLGRADSE = '1'
    </select>
    
    <select id="ifcMainDAO.ifcMainEventLineAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainEventLineAjax 조회 */
        <![CDATA[
        SELECT A.TROBLSEQ,
               B.HOSTNAME,
               A.INST_DATE,
               '[' || SUBSTR(A.INST_DATE,0,4) || '.' || SUBSTR(A.INST_DATE,5,2) || '.' || SUBSTR(A.INST_DATE,7,2) ||
               ' ' || SUBSTR(A.INST_DATE,9,2) || ':' || SUBSTR(A.INST_DATE,11,2) || ':' || SUBSTR(A.INST_DATE,13,2) ||
               ']' ||B.HANGUL_HOSTNAME || '(' || B.HOSTNAME || ') ' || A.TROBLCN AS EVENT_TEXT
          FROM IOC_SDTIC_TROBL_COLCT_DATA A,
               (SELECT REAL_HOSTNAME, 
                       MAX(HOSTNAME) HOSTNAME, 
                       MAX(HANGUL_HOSTNAME) HANGUL_HOSTNAME 
                  FROM IOC_SDTIC_IFC_HOSTNAME_COLCT
                 GROUP BY REAL_HOSTNAME) B
         WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
           AND A.TROBLPROCESSSTTUS <> '9'
        ORDER BY TROBLSEQ DESC, INST_DATE DESC
        ]]>
    </select>
    
    <select id="ifcMainDAO.ifcMainEventAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainEventAjax 조회 */
        <![CDATA[
        SELECT AA.HOSTNAME,
		       AA.HANGUL_HOSTNAME,
		       AA.DUAL,
		       AA.DUAL_CNT,
		       BB.GUBUN,
		       AA.DISK,
		       AA.CPU,
		       AA.MEM MEMORY,
		       AA.NETIO,
		       AA.INST_DATE
		  FROM (SELECT C.HOSTNAME,
		               MAX(C.HANGUL_HOSTNAME) HANGUL_HOSTNAME,
		               MAX(C.DUAL) DUAL,
		               MAX(C.DUAL_CNT) DUAL_CNT,
		               MAX(A.DISK) DISK,
		               MAX(A.CPU) CPU,
		               MAX(A.MEM) MEM,
		               MAX(A.NETIO) NETIO,
		               MAX(A.INST_DATE) INST_DATE
		          FROM (SELECT REAL_HOSTNAME,
		                       DISK,
		                       CPU,
		                       MEM,
		                       NETIO,
		                       INST_DATE
		                  FROM IOC_SDTIC_IFC_COLCT_DATA) A,
		               (SELECT REAL_HOSTNAME, MAX (INST_DATE) MAX_INST_DATE
		                  FROM IOC_SDTIC_IFC_COLCT_DATA
		                 GROUP BY (REAL_HOSTNAME)) B,
		               IOC_SDTIC_IFC_HOSTNAME_COLCT C
		         WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME 
		           AND A.INST_DATE = B.MAX_INST_DATE 
		           AND A.REAL_HOSTNAME = C.REAL_HOSTNAME 
		           AND C.HOSTNAME = #hostname#
		         GROUP BY C.HOSTNAME) AA,
		       (  SELECT HOSTNAME, MAX (GUBUN) GUBUN
		            FROM IOC_SDTIC_IFC_HOSTNAME
		           GROUP BY HOSTNAME) BB
		 WHERE AA.HOSTNAME = BB.HOSTNAME
		   AND ROWNUM = 1
        ]]>
    </select>
    
    <select id="ifcMainDAO.ifcMainEventWebAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainEventWebAjax 조회 */
        <![CDATA[
          SELECT BB.HOSTNAME,
		         MAX(AA.STAT_DATE) STAT_DATE,
		         SUM (AA.EXEC_CNT) EXEC_CNT,
         		 SUM (DECODE (AA.EXEC_CNT, 0, 0, ROUND ( (AA.RESP_TIME + AA.THINK_TIME) / 10 / 1000))) AS CONCURRENT_VS,
         		 ROUND (AVG (DECODE (AA.EXEC_CNT, 0, 0, AA.RESP_TIME / AA.EXEC_CNT))) AS AVG_RESP_TIME
		    FROM (  SELECT A.CFG_PATH,
		                   MAX(A.STAT_DATE) STAT_DATE,
		                   SUM(A.EXEC_CNT) EXEC_CNT,
		                   SUM(A.RESP_TIME) RESP_TIME,
		                   SUM(A.THINK_TIME) THINK_TIME
		              FROM SYSMSTCC.SMWS_ST_SUMMARY_S A
		             WHERE A.STAT_DATE BETWEEN TO_CHAR ( (SYSDATE - (#time# / 60 / 60)), 'YYYYMMDDhh24miss') AND TO_CHAR (SYSDATE, 'YYYYMMDDhh24miss')
		             GROUP BY A.CFG_PATH) AA,
		         IOC_SDTIC_IFC_CON_NAME BB
		   WHERE AA.CFG_PATH = BB.CON 
		     AND BB.HOSTNAME = #hostname#
		GROUP BY BB.HOSTNAME
        ]]>
    </select>
    
    <select id="ifcMainDAO.ifcMainEventDbAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainEventDbAjax 조회 */
        <![CDATA[
        WITH TEMP
             AS (SELECT A.HOSTNAME,
                        A.HANGUL_HOSTNAME,
                        B.INST_NO
                   FROM (SELECT HOSTNAME,
                   				HANGUL_HOSTNAME  
                   		   FROM IOC_SDTIC_IFC_HOSTNAME_COLCT
						  WHERE REAL_HOSTNAME IN (SELECT REAL_HOSTNAME FROM IOC_SDTIC_IFC_HOSTNAME_COLCT WHERE HOSTNAME = #hostname#)
 							AND HOSTNAME <> #hostname#) A, 
                        DPM.EPI$$INSTANCE B
                  WHERE A.HOSTNAME = B.ORACLE_SID 
                    )
        SELECT CO.HOSTNAME,
               CO.HANGUL_HOSTNAME,
               CO.INST_NO,
               NVL(TS.TOTAL_SESSION,0) TOTAL_SESSION,
               NVL(CEIL(ATS.ACTIVE_SESSION),0) ACTIVE_SESSION,
               NVL(CEIL(EC.EXECUTE_COUNTS),0) EXECUTE_COUNTS,
               NVL(WT.WAIT_TIME,0) WAIT_TIME
          FROM (SELECT HOSTNAME,
                       HANGUL_HOSTNAME,
                       INST_NO 
                  FROM TEMP) CO,
               (SELECT AA.INST_NO,
                       AA.LOGTIME,
                       AA.STATISTIC##,
                       AA.VALUE TOTAL_SESSION
                  FROM (SELECT A.INST_NO,
                               A.LOGTIME,
                               A.STATISTIC##,
                               A.VALUE
                          FROM DPM.EPI$$SYSSTAT A, 
                               DPM.EPI$$STATNAME B, 
                               TEMP D
                         WHERE A.INST_NO = B.INST_NO 
                           AND A.STATISTIC## = B.STATISTIC##
                           AND B.NAME = 'logons current' 
                           AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi') 
                           AND A.INST_NO = D.INST_NO) AA,
                       (  SELECT A.INST_NO, 
                                 A.STATISTIC##, 
                                 MAX (A.LOGTIME) MAX_LOGTIME
                            FROM DPM.EPI$$SYSSTAT A, 
                                 DPM.EPI$$STATNAME B, 
                                 TEMP D
                           WHERE A.INST_NO = B.INST_NO 
                             AND A.STATISTIC## = B.STATISTIC## 
                             AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi') 
                             AND A.INST_NO = D.INST_NO 
                             AND B.NAME = 'logons current'
                        GROUP BY A.INST_NO, A.STATISTIC##) BB
                 WHERE AA.LOGTIME = BB.MAX_LOGTIME 
                   AND AA.INST_NO = BB.INST_NO 
                   AND AA.STATISTIC## = BB.STATISTIC##) TS,
               (SELECT AA.INST_NO, 
                       AA.LOGTIME, 
                       AA.AVG_ASESCNT ACTIVE_SESSION
                  FROM (SELECT A.INST_NO, 
                               A.LOGTIME, 
                               A.AVG_ASESCNT
                          FROM DPM.EPI$$ACT_SESSION A, 
                               TEMP D
                         WHERE A.INST_NO = D.INST_NO 
                           AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')) AA,
                       (  SELECT A.INST_NO, 
                                 MAX (A.LOGTIME) MAX_LOGTIME
                            FROM DPM.EPI$$ACT_SESSION A, 
                                 TEMP D
                           WHERE A.INST_NO = D.INST_NO 
                             AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')
                        GROUP BY A.INST_NO) BB
                 WHERE AA.LOGTIME = BB.MAX_LOGTIME 
                   AND AA.INST_NO = BB.INST_NO) ATS,
                 (SELECT AA.INST_NO,
                         AA.LOGTIME,
                         AA.STATISTIC##,
                         ROUND ( (DECODE (SIGN (B_VALUE - A_VALUE), -1, 0, B_VALUE - A_VALUE)) / 60, 2) EXECUTE_COUNTS
                    FROM (SELECT A.INST_NO,
                                 A.LOGTIME,
                                 A.STATISTIC##,
                                 A.VALUE A_VALUE,
                                 B.VALUE B_VALUE
                            FROM DPM.EPI$$SYSSTAT A,
                                 DPM.EPI$$SYSSTAT B,
                                 DPM.EPI$$STATNAME C,
                                 TEMP D
                           WHERE A.INST_NO = C.INST_NO 
                             AND A.LOGTIME > TO_CHAR (SYSDATE - 1 / 24, 'YYYYMMDDhh24mi') 
                             AND A.STATISTIC## = C.STATISTIC## 
                             AND B.INST_NO = A.INST_NO 
                             AND B.STATISTIC## = A.STATISTIC## 
                             AND A.INST_NO = D.INST_NO 
                             AND C.NAME = 'execute count' 
                             AND B.LOGTIME = TO_CHAR (TO_DATE (A.LOGTIME, 'YYYYMMDDhh24mi') + (1 / 60 / 24), 'YYYYMMDDhh24mi')) AA,
                         (  SELECT A.INST_NO, 
                                   A.STATISTIC##, 
                                   MAX (A.LOGTIME) MAX_LOGTIME
                              FROM DPM.EPI$$SYSSTAT A,
                                   DPM.EPI$$SYSSTAT B,
                                   DPM.EPI$$STATNAME C,
                                   TEMP D
                             WHERE A.INST_NO = C.INST_NO 
                               AND A.LOGTIME > TO_CHAR (SYSDATE - 1 / 24, 'YYYYMMDDhh24mi') 
                               AND A.STATISTIC## = C.STATISTIC##
                               AND B.INST_NO = A.INST_NO 
                               AND B.STATISTIC## = A.STATISTIC## 
                               AND A.INST_NO = D.INST_NO 
                               AND C.NAME = 'execute count' 
                               AND B.LOGTIME = TO_CHAR (TO_DATE (A.LOGTIME, 'YYYYMMDDhh24mi') + (1 / 60 / 24), 'YYYYMMDDhh24mi')
                          GROUP BY A.INST_NO, A.STATISTIC##) BB
                   WHERE AA.LOGTIME = BB.MAX_LOGTIME 
                     AND AA.INST_NO = BB.INST_NO 
                     AND AA.STATISTIC## = BB.STATISTIC##) EC,
               (SELECT AA.INST_NO, 
                       AA.LOGTIME, ("CPU TIME" + "I/O" + "LOCK" + "LATCH" + "CONCURRENCY" + "NETWORK" + "RAC" + "OTHER") AS WAIT_TIME
                  FROM (  SELECT A.INST_NO,
                                 LOGTIME,
                                 ROUND (SUM (CPU_TIME) / 60, 2) "CPU TIME",
                                 ROUND (SUM (EVENT1) / 60, 2) "I/O",
                                 ROUND (SUM (EVENT2) / 60, 2) "LOCK",
                                 ROUND (SUM (EVENT3) / 60, 2) "LATCH",
                                 ROUND (SUM (EVENT4) / 60, 2) "CONCURRENCY",
                                 ROUND (SUM (EVENT5) / 60, 2) "NETWORK",
                                 ROUND (SUM (EVENT6) / 60, 2) "RAC",
                                 ROUND (SUM (EVENT7) / 60, 2) "OTHER"
                            FROM DPM.EPI$$LOG_SESS_EVENT_CAT_MIN A, 
                                 TEMP D
                           WHERE A.INST_NO = D.INST_NO 
                             AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')
                        GROUP BY A.INST_NO, LOGTIME) AA,
                       (  SELECT A.INST_NO, 
                             MAX (LOGTIME) MAX_LOGTIME
                            FROM DPM.EPI$$LOG_SESS_EVENT_CAT_MIN A, 
                                 TEMP D
                           WHERE A.INST_NO = D.INST_NO 
                             AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')
                        GROUP BY A.INST_NO) BB
                 WHERE AA.LOGTIME = BB.MAX_LOGTIME 
                   AND AA.INST_NO = BB.INST_NO) WT
         WHERE CO.INST_NO = TS.INST_NO(+)
           AND CO.INST_NO = ATS.INST_NO(+)
           AND CO.INST_NO = EC.INST_NO(+)
           AND CO.INST_NO = WT.INST_NO(+)
        ]]>
    </select>
    
    <select id="ifcMainDAO.ifcMainEventLogListAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainEventLogListAjax 조회 */
        <![CDATA[
        SELECT A.TROBLSEQ, 
		       A.TROBLPROCESSSTTUS,
		       A.ACTIONCN,
		       A.CRE_DATE
		  FROM IOC_SDTIC_TROBL_COLCT_LOG A
		 WHERE A.TROBLSEQ = #troblseq#
		 ORDER BY TROBLPROCESSSTTUS
        ]]>
    </select>
    
    <select id="ifcMainDAO.ifcMainExtrlcntcAjax" parameterClass="ifcMainVO" resultClass="ifcMainVO">
        /* ifcMainExtrlcntcAjax 조회 */
          SELECT BB.HOSTNAME CMMN_CD,
		         CC.HANGUL_HOSTNAME CMMN_CD_NM,
		         AA.INST_DATE CRE_DTTM,
		         AA.NETERR IS_ERROR
		    FROM (SELECT A.REAL_HOSTNAME, 
		                 MAX(A.NETERR) NETERR, 
		                 MAX(A.INST_DATE) INST_DATE
		            FROM (SELECT REAL_HOSTNAME, 
		                         NETERR, 
		                         INST_DATE
		                    FROM IOC_SDTIC_IFC_COLCT_DATA) A,
		                 (  SELECT REAL_HOSTNAME, 
		                           MAX (INST_DATE) MAX_INST_DATE
		                      FROM IOC_SDTIC_IFC_COLCT_DATA
		                     GROUP BY (REAL_HOSTNAME)) B
		           WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
		             AND A.INST_DATE = B.MAX_INST_DATE
		           GROUP BY A.REAL_HOSTNAME) AA,
		         IOC_SDTIC_IFC_HOSTNAME_COLCT BB,
		         IOC_SDTIC_IFC_HOSTNAME CC
		   WHERE AA.REAL_HOSTNAME = BB.REAL_HOSTNAME
		     AND BB.HOSTNAME = CC.HOSTNAME
		     AND CC.GUBUN = #gubun#
		   ORDER BY CMMN_CD_NM
    </select>

</sqlMap>