<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ifcRlay">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="ifcRlayVO"  type="egovframework.com.sdtic.ifcrs.service.IfcRlayVO" />
    
    <select id="ifcRlayDAO.ifcRlayServerAjax" parameterClass="ifcRlayVO" resultClass="ifcRlayVO">
        /* ifcRlayServerAjax 조회 */
        SELECT AA.GUBUN,
               AA.GROUP1,
               AA.GROUP2,
               MAX(BB.INST_DATE) INST_DATE,
               MAX(BB.DISK) DISK,
               MAX(BB.CPU) CPU,
               MAX(BB.MEM) MEMORY,
               (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND CODE_LEVEL = 2) GROUP1_NAME,
               (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_NAME,
               (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND CODE_LEVEL = 2) GROUP1_ORDER,
               (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_ORDER
          FROM IOC_SDTIC_IFC_HOSTNAME AA,
               (SELECT D.HOSTNAME,
                       MAX(A.DISK) DISK,
                       MAX(A.CPU) CPU,
                       MAX(A.MEM) MEM,
                       MAX(A.INST_DATE) INST_DATE
                  FROM (SELECT REAL_HOSTNAME,
                               DISK,
                               CPU,
                               MEM,
                               INST_DATE
                          FROM IOC_SDTIC_IFC_COLCT_DATA) A,
                       (SELECT REAL_HOSTNAME, MAX(INST_DATE) MAX_INST_DATE
                          FROM IOC_SDTIC_IFC_COLCT_DATA
                         GROUP BY (REAL_HOSTNAME)) B,
                       IOC_SDTIC_IFC_HOSTNAME_COLCT C,
                       IOC_SDTIC_IFC_HOSTNAME D
                 WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
                   AND A.INST_DATE = B.MAX_INST_DATE
                   AND A.REAL_HOSTNAME = C.REAL_HOSTNAME
                   AND C.HOSTNAME = D.HOSTNAME
                   AND D.GUBUN = #gubun#
                 GROUP BY D.HOSTNAME
               ) BB
         WHERE AA.HOSTNAME = BB.HOSTNAME(+)
           AND AA.GUBUN = #gubun#
         GROUP BY GUBUN, GROUP1, GROUP2
         ORDER BY GROUP1_ORDER, GROUP2_ORDER
    </select>
</sqlMap>