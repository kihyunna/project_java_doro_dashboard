<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c"       uri="http://java.sun.com/jsp/jstl/core"                     %>

<!DOCTYPE html>
<html lang="ko">
<head>
<title></title>
    <meta charset="utf-8">
    <title>비즈니스 유지관리 누적접속자 화면</title>
    <!-- including ECharts file -->
    <c:set var="contextPath" value="${pageContext.request.contextPath}" />
    <script type="text/javascript" src="${contextPath}/js/common/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="${contextPath}/js/bucrs/anime.js"></script>

    <link rel="stylesheet" type="text/css" href="${contextPath}/css/main/magicTime.css">
    <link rel="stylesheet" type="text/css" href="${contextPath}/css/main/default.css" />
</head>

<body>
    <div id="wrap_if">
        <div id="pln_main" class="sctSmrSys tpMntn">
            <div class="areaSys"><!--유지관리--></div>
            <div class="areaIndC">
                <span class="txtItem">유지관리실적</span><br /><span id="data1" class="txtNum" > %</span>
            </div>
            <div class="areaCUsr">
                <span class="txtItem">금일누적접속자</span><br /><span id="JSobjectProp" class="txtNum">명</span>
            </div>
        </div>
    </div>
    <!-- <div id="main" style="width:100%;height:90px; padding:0px; "> //-->

    <%-- <img id="img1" src="${contextPath}/images/bucrs/corrective_top.png" width="100%" height="90px">
         <table>
            <tr style="height:55px;">
                <td style="width:160px;" align='center'>
                    <table>
                        <tr>
                            <td><center><img src="${contextPath}/images/bucrs/corrective.png" width="80px" height="40px"></center></td>
                        </tr>
                        <tr>
                            <td align='center' valign='top'><font face="돋움" size="3px" color="#FFFFFF"><b>유지관리</b></font></td>
                        </tr>
                    </table>
                </td>
                <td style="width:300px;" >
                    <table>
                        <tr >
                            <td style="width:190px;" align='left'>
                                <font face="돋움" size="3px" color="#FFFFFF">
                                    <b>
                                        금일 누적 접속자
                                    </b>
                                </font>
                            </td>
                            <td style="width:30px;" align='left'>
                                <font face="돋움" size="3px" color="#FFFFFF">
                                    <b>
                                        <div id="JSobjectProp">
                                            100
                                        </div>
                                    </b>
                                </font>

                            </td>
                            <td style="width:5px;">
                                <font face="돋움" size="3px" color="#FFFFFF">
                                    <b>
                                        명
                                    </b>
                                </font>
                            </td>
                            <td style="width:30px;">
                            </td>

                        </tr>

                        <tr style="height:25px;">
                            <td style="width:190px;" align='left'>
                                <font face="돋움" size="3px" color="#FFFFFF">
                                    <b>
                                        유지관리 실적
                                    </b>
                                </font>
                            </td>
                            <td colspan="3" align='left'>
                                <font face="돋움" size="3px" color="#FFFFFF">
                                    <b>
                                        <div id="data1">56  %</div>
                                    </b>
                                </font>
                            </td>
                            <td style="width:30px;">
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>--%>
    <script type="text/javascript">
		var usercnt = '';	
		var plan_km = '';
		var c_km = '';
		var complete_p = '';
		var ParamTime = 0;
         $(window).load(function() {
        	 document.documentElement.style.overflow = 'hidden';
			getMntmngAccmltConectrdb();
			 
			
		    ParamTime = "${param.widgetTimer}"
                
                if(ParamTime == 0){
                    ParamTime = 10000;
                }
		  //이벤트
            if(window.addEventListener) {
                window.addEventListener("message", uf_receiveMessage, false);
            }else if(window.attachEvent) {  //IE에서 이벤트 등록
                window.attachEvent("onmessage", uf_receiveMessage);
            }
		    
		  
            timerStart();
			
           
         	
        });

        $(window).resize(function(){

            //setDivHeight('main');

        });

        function setDivHeight(objSet)
        {


            var objSet   = document.getElementById(objSet);
            objSet.style.width  = 100 + "%";
            objSet.style.height  = $(window).height() + "px";

        }

        function getMntmngAccmltConectrdb(){
            $.ajax({
                url : "${pageContext.request.contextPath}/buc/bucMntmngAccmltConectrdbAjax.do",
                async : false,
                dataType : 'json',
                success :function(json) {
					if(json.data.length > 0) {
						usercnt = json.data[0].cnt;
	                    $('#JSobjectProp').text(json.data[0].cnt + '명');
					}
					else {
						$('#JSobjectProp').text(0 + '명');
					}
					

                },error : function(){

                    console.log(arguments);
                }, complete : function() {
                	var tempText = $('#JSobjectProp').text().replace(' 명','');
                    
                    var prop1 = parseInt(tempText);

                    var myObject = { prop1: 0 };
                    var JSobjectProp = anime({
                        targets: myObject,
                        prop1: prop1,
                        easing: 'linear',
                        
                        round: 1,
                        update: function() {
                            var el = document.querySelector('#JSobjectProp');

                            var jsonString = JSON.stringify(myObject).replace('{"prop1":','').replace('"}','').replace('"','');

                            el.innerHTML = jsonString+ ' 명';
                        }
                    });
                }
            });

            $.ajax({
                url : "${pageContext.request.contextPath}/buc/bucMntmngRtdbAjax.do",
                async : false,
                dataType : 'json',
                success :function(json) {
			        if(json.data.length > 0) {
	                	plan_km = json.data[0].plan_km;
	                	c_km = json.data[0].c_km;
						complete_p = json.data[0].complete_p;
	                    $('#data1').text(json.data[0].complete_p + " %");
			        }     
			        else {
			        	$('#data1').text(0 + " %");
			        }
                	

                },error : function(){

                    console.log(arguments);
                }, complete : function() {
                    var tempText = $('#data1').text().replace(' %','');
                    
                    var prop2 = parseInt(tempText);
                    var myObject2 = { prop2: 0 };
                    var JSobjectProp = anime({
                        targets: myObject2,
                        prop2: prop2,
                        easing: 'linear',
                        
                        round: 1,
                        update: function() {
                            var el = document.querySelector('#data1');

                            var jsonString = JSON.stringify(myObject2).replace('{"prop2":','').replace('"}','').replace('"','');

                            el.innerHTML = jsonString + ' %';
                        }
                    });
                }
            }); 

        }

        function randomCnt(){
        	getMntmngAccmltConectrdb();

        }

        function timerStart(){
            
        	setInterval(function() {
                randomCnt();
            }, ParamTime);
        }

        

        
        
      //성능 위젯으로 서버통신
        function fn_tranServer(data){
            var callCommandVariable = {
                classType: "1",
                command : "bucMntmng",
                data : {
                    bucData : data
                }
            };
            setTimeout(function(){
                parent.postMessage(callCommandVariable, "*");
            }, 1000);
        }
        
        function uf_receiveMessage(e){
            var command = e.data.command;
            switch(command){
                case 'ReturnbucMntmng' : {
                    
                    //alert(1);
                    
                        $("#pln_main").removeClass("sctSmrSys tpPln active");
                        $("#pln_main").addClass('sctSmrSys tpPln');
                    
                    
                    fn_tranServer("3");
                    break;
                }
                case 'reSetData' :{
                    if(e.data.data.reSetData == 'reset'){
                        location.reload();
                    } 
                    break;
                }
                
                default : {
                    if(parseInt(e.data.data.bucData) == 2){
                        $("#pln_main").addClass('sctSmrSys tpPln active');
                    }
                    break;
                } 
            }
        }

    </script>
</body>
</html>
