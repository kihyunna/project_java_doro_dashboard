<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="fecTotlInsrTotDAO">
	<typeAlias  alias="fecSlpVO"  type="egovframework.com.sdtic.fecrs.service.fecSlpVO" />
	<typeAlias  alias="fecCctvVO"  type="egovframework.com.sdtic.fecrs.service.fecCctvVO" />
	<typeAlias  alias="fecEventVO"  type="egovframework.com.sdtic.fecrs.service.fecEventVO" />
    <typeAlias  alias="FecSearchVO"  type="egovframework.com.sdtic.fecrs.service.FecSearchVO" />
    
    <select id="fecTotlInsrTotDAO.fecGetSlp" resultClass="fecSlpVO">  
	    SELECT a.msis_gtwy_id,
	    	   a.fclts_intg_id,
		       b.msis_snsr_id,
		       a.pbus_jrsd_hdqr_cd hdqr_cd,
		       a.hdqr_nm,
		       a.pbus_jrsd_mtnof_cd mtnof_cd,
		       a.mtnof_nm,
		       a.pbus_route_cd,
		       a.use_rotnm,
		       a.regin_nm,
		       a.pbus_stpnt_dstnc,
		       a.drve_drnm,
		       a.pbus_drve_drct_cd,
		       a.ggtm_xcord,
		       a.ggtm_ycord
		  FROM T_EXMF_MSIS_MGMT01M1 a, T_EXMF_SNSR_MGMT01M1 b
		 WHERE a.MSIS_GTWY_ID = b.MSIS_GTWY_ID AND a.USE_YN = 'Y'
    </select> 
    
    <select id="fecTotlInsrTotDAO.fecGetTroblSlp" resultClass="fecSlpVO">  
		SELECT msis_gtwy_id,
		       msis_snsr_id,
		       trobl_type,
		       use_yn,
		       to_char (fsttm_rgst_dttm, 'yyyymmddhh24miss') fsttm_rgst_dttm,
		       to_char (lsttm_altr_dttm, 'yyyymmddhh24miss') lsttm_altr_dttm
		  FROM (  SELECT MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 '1' AS trobl_type,
		                 use_yn,
		                 FSTTM_RGST_DTTM,
		                 MAX (LSTTM_ALTR_DTTM) LSTTM_ALTR_DTTM
		            FROM T_EXMF_SNSR_SHCK_AMNT01M1
		           WHERE     1 = 1
		                 AND MSIS_ALRM_ID  <![CDATA[  <>  ]]>  '0'
		                 AND LSTTM_ALTR_DTTM >=
		                        TO_DATE (to_char(sysdate, 'yyyymmdd')||'000000', 'yyyymmddhh24miss')
		        GROUP BY MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 use_yn,
		                 FSTTM_RGST_DTTM
		        UNION ALL
		          SELECT MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 '2' AS trobl_type,
		                 use_yn,
		                 FSTTM_RGST_DTTM,
		                 MAX (LSTTM_ALTR_DTTM) LSTTM_ALTR_DTTM
		            FROM T_EXMF_SNSR_BTRY_STAT01M1
		           WHERE     1 = 1
		                 AND MSIS_ALRM_ID <![CDATA[  <>  ]]> '0'
		                 AND LSTTM_ALTR_DTTM >=
		                        TO_DATE (to_char(sysdate, 'yyyymmdd')||'000000', 'yyyymmddhh24miss')
		        GROUP BY MSIS_GTWY_ID,
		                 MSIS_SNSR_ID,
		                 use_yn,
		                 FSTTM_RGST_DTTM)
    </select>  
    
    <select id="fecTotlInsrTotDAO.fecGetEventSlp" parameterClass="String" resultClass="fecSlpVO">  
				SELECT msis_idx_seq,
				       msis_gtwy_id,
				       msis_snsr_id,
				       msis_ntfc_kind_cd,
				       to_char (fsttm_rgst_dttm, 'yyyymmddhh24miss') fsttm_rgst_dttm,
		       		   to_char (lsttm_altr_dttm, 'yyyymmddhh24miss') lsttm_altr_dttm,
				       use_yn
				  FROM T_EXMF_SNSR_ALRM01M1
				 WHERE     LSTTM_ALTR_DTTM <![CDATA[  >=  ]]> TO_DATE (to_char(sysdate, 'yyyymmdd')||'000000', 'yyyymmddhh24miss')
				       AND MSIS_IDX_SEQ <![CDATA[  >  ]]> #msis_idx_seq#
    </select> 
    
    <select id="fecTotlInsrTotDAO.checkCCTV" parameterClass="String" resultClass="fecCctvVO">  
				select spin_intg_id,spin_intg_nm,data_id,hdqr_cd,mtnof_cd,route_cd,route_drct_cd,insl_dstnc,ggtm_xcord,ggtm_ycord
				from V_EXMD_SPIN_HIWAY_CCTV01L1
				where hdqr_cd = #hdqr_cd#
				order by HDQR_CD,MTNOF_CD
    </select> 
    
    <select id="fecTotlInsrTotDAO.fecGetEventMdtAjax" parameterClass="FecSearchVO" resultClass="fecEventVO">  
		select b.hdqr_nm, b.mtnof_nm, b.mtnof_cd, GGTM_XCORD as xcord,  GGTM_YCORD as ycord, 1 coord_type,  0 recover,  ' 장애 ' content,
        a.SPIN_INTG_NM fclts_name,  to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss') event_time 
        from 
		(select * From IOC_SDTIC_HIWAY_CCTV where cctvurl is null) a,
		IOC_SDTIC_COMMON_DEPT b
		where a.MTNOF_CD = b.MTNOF_CD    
		<isNotEmpty property="deptCode">
		               and b.MTNOF_CD = #deptCode#        
		        </isNotEmpty> 
        order by MTNOF_CD, FCLTS_name
    </select>    
</sqlMap>