<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<!DOCTYPE html>
<html lang="ko" class="cnt_if">
	<head>
	<meta charset="utf-8" />
	<title>현장 중계기</title>
	<!-- including ECharts file -->
	    <c:set var="contextPath" value="${pageContext.request.contextPath}" />
	    
	    <link rel="stylesheet" type="text/css" href="${contextPath}/css/main/default.css" />
	
	    <script type="text/javascript" src="${contextPath}/js/common/jquery-2.1.4.min.js"></script>
	    <script type="text/javascript" src="${contextPath}/js/echarts/dist/echarts.min.js"></script>

	    <script type="text/javascript" src="${contextPath}/js/echarts/theme/dark.js"></script>
	    <script type="text/javascript" src="${contextPath}/js/main/MainSptRelayView.js"></script>
	    
	    <script type="text/javascript">
            $(window).load(function(){
                getData();
                
                setDivHeight('main');
            });
            
            //리사이즈
            $(window).resize(function(){
                setDivHeight('main');
            });
            
            function setDivHeight(objSet){ 
                var objSet   = document.getElementById(objSet); 
                objSet.style.width  = ($(window).width()) + "px";
                objSet.style.height  = ($(window).height()) + "px";
                
                $(objSet).width(($(window).width()) + "px");
                $(objSet).height(($(window).height()) + "px");
                
                myChart.resize({
                    width: $(window).width(),
                    height : $(window).height()
                });
            }
        </script>
	</head>
	
	<!-- 백그라운드 이미지 넣으면 차트도 동일하게 적용됩니다. -->
	<body>
	    <div id="main" style="width:500px;height:150px;"></div>
	    
	    <script type="text/javascript">
	        var myChart = echarts.init(document.getElementById('main'), 'dark');
	        myChart.setOption(option);
	        
	        var chkStyle = /\d/;
            var widgetTimer = 60000 * 10;	//10분
            var paramWidgetTimer = "${param.widgetTimer}";
            if(paramWidgetTimer != null){
            	if(chkStyle.test(paramWidgetTimer)){
            		if(paramWidgetTimer != 0){
            			widgetTimer = paramWidgetTimer;
            		}
            	}
            }
	        
	        function getData(){
                $.ajax({
                    url : "${pageContext.request.contextPath}/main/mainSptRelay.do",
                    async : false,
                    dataType : 'json',
                    success :function(json) {
                        for(var i=0;i<json.data.length;i++){
                        	bonbu[i] = json.data[i].group2_name;
                        }
                        
                        for(var i=0;i<bonbu.length;i++) {
	                        if(yMax < json.data[i].total_cnt){
	                        	yMax = json.data[i].total_cnt;
	                        }
                        }
                        if(yMax > 10){
                        	yMax = Math.ceil(yMax/10) * 10;
                        }
                        
                        for(var i=0;i<bonbu.length;i++){
                        	dataShadow[i] = yMax;
	                        dataNormal[i] = json.data[i].normal_cnt;
	                        dataDanger[i] = json.data[i].danger_cnt;
                        }
                        
                        myChart.setOption(option);               
                    },error : function(){
                        console.log(arguments);
                    }
                });
            }
			
	        timeTicket = setInterval(function () {
	        	getData();
	        }, widgetTimer);
	    </script>
	</body>
</html>