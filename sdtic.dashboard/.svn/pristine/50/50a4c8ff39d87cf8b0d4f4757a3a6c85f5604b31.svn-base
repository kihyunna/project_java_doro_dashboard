<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ifcDb">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="ifcDbVO"  type="egovframework.com.sdtic.ifcrs.service.IfcDbVO" />
    
    <select id="ifcDbDAO.ifcDbUnityAjax" parameterClass="ifcDbVO" resultClass="ifcDbVO">
        /* ifcDbUnityAjax 조회 */
        SELECT B.HOSTNAME,
               A.DISK,
               A.CPU,
               A.MEM MEMORY,
               A.INST_DATE,
               A.CRE_DATE
          FROM IOC_SDTIC_IFC_COLCT_DATA A,
               IOC_SDTIC_IFC_HOSTNAME B,
               IOC_SDTIC_IFC_HOSTNAME_COLCT C
         WHERE A.REAL_HOSTNAME = C.REAL_HOSTNAME
           AND B.HOSTNAME = C.HOSTNAME
	       AND B.GUBUN = #gubun#		/* DB */
	       AND B.GROUP1 = #group1#		/* DB */
	       AND B.GROUP2 = #group2#		/* CFM */
           AND ROWNUM = 1
         ORDER BY INST_DATE DESC
    </select>

    <select id="ifcDbDAO.ifcDbCntrlAjax" parameterClass="ifcDbVO" resultClass="ifcDbVO">
        /* ifcDbCntrlAjax 조회 */
        SELECT B.HOSTNAME,
               A.DISK,
               A.CPU,
               A.MEM MEMORY,
               A.INST_DATE,
               A.CRE_DATE
          FROM IOC_SDTIC_IFC_COLCT_DATA A,
               IOC_SDTIC_IFC_HOSTNAME B,
               IOC_SDTIC_IFC_HOSTNAME_COLCT C
         WHERE A.REAL_HOSTNAME = C.REAL_HOSTNAME
           AND B.HOSTNAME = C.HOSTNAME
	       AND B.GUBUN = #gubun#		/* DB */
	       AND B.GROUP1 = #group1#		/* DB */
	       AND B.GROUP2 = #group2#		/* CFD */
           AND ROWNUM = 1
         ORDER BY INST_DATE DESC
    </select>
    
    <select id="ifcDbDAO.ifcDbDpm1Ajax" parameterClass="ifcDbVO" resultClass="ifcDbVO">
        /* ifcDbDpm1Ajax 조회 */
        <![CDATA[
        WITH TEMP
		     AS (SELECT A.GUBUN,
		                A.GROUP1,
		                A.GROUP2,
		                B.HOSTNAME,
		                C.INST_NO,
		                (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) CODE_NAME,
		                (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = A.GUBUN AND GROUP1 = A.GROUP1 AND GROUP2 = A.GROUP2 ) CODE_ORDER
		           FROM IOC_SDTIC_IFC_CODE A, 
		                IOC_SDTIC_IFC_HOSTNAME B, 
		                DPM.EPI$$INSTANCE C
		          WHERE A.GUBUN = B.GUBUN 
		            AND A.GROUP1 = B.GROUP1 
		            AND A.GROUP2 = B.GROUP2 
		            AND B.HOSTNAME = C.ORACLE_SID 
			           AND A.GUBUN = #gubun#
			           AND A.GROUP1 = #group1#
			        )
		SELECT CO.GUBUN,
		       CO.GROUP1,
		       CO.GROUP2,
		       CO.HOSTNAME,
		       CO.CODE_NAME,
		       CO.CODE_ORDER,
		       CO.INST_NO,
		       NVL(TS.TOTAL_SESSION,0) TOTAL_SESSION,
		       NVL(CEIL(ATS.ACTIVE_SESSION),0) ACTIVE_SESSION,
		       NVL(CEIL(EC.EXECUTE_COUNTS),0) EXECUTE_COUNTS,
		       NVL(WT.WAIT_TIME,0) WAIT_TIME
		  FROM (SELECT GUBUN,
		               GROUP1,
		               GROUP2,
		               HOSTNAME,
		               CODE_NAME,
		               CODE_ORDER,
		               INST_NO 
		          FROM TEMP) CO,
		       (SELECT AA.INST_NO,
		               AA.LOGTIME,
		               AA.STATISTIC##,
		               AA.VALUE TOTAL_SESSION
		          FROM (SELECT A.INST_NO,
		                       A.LOGTIME,
		                       A.STATISTIC##,
		                       A.VALUE
		                  FROM DPM.EPI$$SYSSTAT A, 
		                       DPM.EPI$$STATNAME B, 
		                       TEMP D
		                 WHERE A.INST_NO = B.INST_NO 
		                   AND A.STATISTIC## = B.STATISTIC## 
		                   AND B.NAME = 'logons current' 
		                   AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi') 
		                   AND A.INST_NO = D.INST_NO) AA,
		               (  SELECT A.INST_NO, 
		                         A.STATISTIC##, 
		                         MAX (A.LOGTIME) MAX_LOGTIME
		                    FROM DPM.EPI$$SYSSTAT A, 
		                         DPM.EPI$$STATNAME B, 
		                         TEMP D
		                   WHERE A.INST_NO = B.INST_NO 
		                     AND A.STATISTIC## = B.STATISTIC## 
		                     AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi') 
		                     AND A.INST_NO = D.INST_NO 
		                     AND B.NAME = 'logons current'
		                GROUP BY A.INST_NO, A.STATISTIC##) BB
		         WHERE AA.LOGTIME = BB.MAX_LOGTIME 
		           AND AA.INST_NO = BB.INST_NO 
		           AND AA.STATISTIC## = BB.STATISTIC##) TS,
		       (SELECT AA.INST_NO, 
		               AA.LOGTIME, 
		               AA.AVG_ASESCNT ACTIVE_SESSION
		          FROM (SELECT A.INST_NO, 
		                       A.LOGTIME, 
		                       A.AVG_ASESCNT
		                  FROM DPM.EPI$$ACT_SESSION A, 
		                       TEMP D
		                 WHERE A.INST_NO = D.INST_NO 
		                   AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')) AA,
		               (  SELECT A.INST_NO, 
		                         MAX (A.LOGTIME) MAX_LOGTIME
		                    FROM DPM.EPI$$ACT_SESSION A, 
		                         TEMP D
		                   WHERE A.INST_NO = D.INST_NO 
		                     AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')
		                GROUP BY A.INST_NO) BB
		         WHERE AA.LOGTIME = BB.MAX_LOGTIME 
		           AND AA.INST_NO = BB.INST_NO) ATS,
		         (SELECT AA.INST_NO,
		                 AA.LOGTIME,
		                 AA.STATISTIC##,
		                 ROUND ( (DECODE (SIGN (B_VALUE - A_VALUE), -1, 0, B_VALUE - A_VALUE)) / 60, 2) EXECUTE_COUNTS
		            FROM (SELECT A.INST_NO,
		                         A.LOGTIME,
		                         A.STATISTIC##,
		                         A.VALUE A_VALUE,
		                         B.VALUE B_VALUE
		                    FROM DPM.EPI$$SYSSTAT A,
		                         DPM.EPI$$SYSSTAT B,
		                         DPM.EPI$$STATNAME C,
		                         TEMP D
		                   WHERE A.INST_NO = C.INST_NO 
		                     AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi') 
		                     AND A.STATISTIC## = C.STATISTIC## 
		                     AND B.INST_NO = A.INST_NO 
		                     AND B.STATISTIC## = A.STATISTIC## 
		                     AND A.INST_NO = D.INST_NO 
		                     AND C.NAME = 'execute count' 
		                     AND B.LOGTIME = TO_CHAR (TO_DATE (A.LOGTIME, 'YYYYMMDDhh24mi') + (1 / 60 / 24), 'YYYYMMDDhh24mi')) AA,
		                 (  SELECT A.INST_NO, 
		                           A.STATISTIC##, 
		                           MAX (A.LOGTIME) MAX_LOGTIME
		                      FROM DPM.EPI$$SYSSTAT A,
		                           DPM.EPI$$SYSSTAT B,
		                           DPM.EPI$$STATNAME C,
		                           TEMP D
		                     WHERE A.INST_NO = C.INST_NO 
		                       AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi') 
		                       AND A.STATISTIC## = C.STATISTIC##
		                       AND B.INST_NO = A.INST_NO 
		                       AND B.STATISTIC## = A.STATISTIC## 
		                       AND A.INST_NO = D.INST_NO 
		                       AND C.NAME = 'execute count' 
		                       AND B.LOGTIME = TO_CHAR (TO_DATE (A.LOGTIME, 'YYYYMMDDhh24mi') + (1 / 60 / 24), 'YYYYMMDDhh24mi')
		                  GROUP BY A.INST_NO, A.STATISTIC##) BB
		           WHERE AA.LOGTIME = BB.MAX_LOGTIME 
		             AND AA.INST_NO = BB.INST_NO 
		             AND AA.STATISTIC## = BB.STATISTIC##) EC,
		       (SELECT AA.INST_NO, 
		               AA.LOGTIME, ("CPU TIME" + "I/O" + "LOCK" + "LATCH" + "CONCURRENCY" + "NETWORK" + "RAC" + "OTHER") AS WAIT_TIME
		          FROM (  SELECT A.INST_NO,
		                         LOGTIME,
		                         ROUND (SUM (CPU_TIME) / 60, 2) "CPU TIME",
		                         ROUND (SUM (EVENT1) / 60, 2) "I/O",
		                         ROUND (SUM (EVENT2) / 60, 2) "LOCK",
		                         ROUND (SUM (EVENT3) / 60, 2) "LATCH",
		                         ROUND (SUM (EVENT4) / 60, 2) "CONCURRENCY",
		                         ROUND (SUM (EVENT5) / 60, 2) "NETWORK",
		                         ROUND (SUM (EVENT6) / 60, 2) "RAC",
		                         ROUND (SUM (EVENT7) / 60, 2) "OTHER"
		                    FROM DPM.EPI$$LOG_SESS_EVENT_CAT_MIN A, 
		                         TEMP D
		                   WHERE A.INST_NO = D.INST_NO 
		                     AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')
		                GROUP BY A.INST_NO, LOGTIME) AA,
		               (  SELECT A.INST_NO, 
		                     MAX (LOGTIME) MAX_LOGTIME
		                    FROM DPM.EPI$$LOG_SESS_EVENT_CAT_MIN A, 
		                         TEMP D
		                   WHERE A.INST_NO = D.INST_NO 
		                     AND A.LOGTIME > TO_CHAR (SYSDATE - (1 / 24), 'YYYYMMDDhh24mi')
		                GROUP BY A.INST_NO) BB
		         WHERE AA.LOGTIME = BB.MAX_LOGTIME 
		           AND AA.INST_NO = BB.INST_NO) WT
		 WHERE CO.INST_NO = TS.INST_NO(+)
		   AND CO.INST_NO = ATS.INST_NO(+)
		   AND CO.INST_NO = EC.INST_NO(+)
		   AND CO.INST_NO = WT.INST_NO(+)
		 ORDER BY CODE_ORDER
		]]>
    </select>
    
    <select id="ifcDbDAO.ifcDbDpm2Ajax" parameterClass="ifcDbVO" resultClass="ifcDbVO">
        /* ifcDbDpm2Ajax 조회 */
        <![CDATA[
        SELECT #hostname1# HOSTNAME,
		       ROWNUM,
		       TS.INST_NO,
		       TS.LOGTIME,
		       TS.TABLESPACE_NAME,
		       TS.USED_PERCENT
		  FROM (  SELECT AA.INST_NO,
		                 AA.LOGTIME,
		                 AA.TABLESPACE_NAME,
		                 AA.USED_PERCENT
		            FROM (SELECT A.INST_NO,
		                         A.LOGTIME,
		                         A.TABLESPACE_NAME,
		                         A.USED_PERCENT
		                    FROM DPM.EPI$$TABLESPACE_USAGE A
		                   WHERE A.INST_NO = (SELECT INST_NO
		                                        FROM DPM.EPI$$INSTANCE
		                                       WHERE ORACLE_SID = #hostname1#)) AA,
		                 (  SELECT B.INST_NO,
		                           B.TABLESPACE_NAME,
		                           MAX (B.LOGTIME) MAX_LOGTIME
		                      FROM DPM.EPI$$TABLESPACE_USAGE B
		                     WHERE B.INST_NO = (SELECT INST_NO
		                                          FROM DPM.EPI$$INSTANCE
		                                         WHERE ORACLE_SID = #hostname1#)
		                  GROUP BY B.INST_NO, B.TABLESPACE_NAME) BB
		           WHERE AA.INST_NO = BB.INST_NO
		             AND AA.TABLESPACE_NAME = BB.TABLESPACE_NAME
		             AND AA.LOGTIME = BB.MAX_LOGTIME
		        ORDER BY USED_PERCENT DESC) TS
		 WHERE ROWNUM < 3
		 
		UNION ALL
		
		SELECT #hostname2# HOSTNAME,
		       ROWNUM,
		       TS.INST_NO,
		       TS.LOGTIME,
		       TS.TABLESPACE_NAME,
		       TS.USED_PERCENT
		  FROM (  SELECT AA.INST_NO,
		                 AA.LOGTIME,
		                 AA.TABLESPACE_NAME,
		                 AA.USED_PERCENT
		            FROM (SELECT A.INST_NO,
		                         A.LOGTIME,
		                         A.TABLESPACE_NAME,
		                         A.USED_PERCENT
		                    FROM DPM.EPI$$TABLESPACE_USAGE A
		                   WHERE A.INST_NO = (SELECT INST_NO
		                                        FROM DPM.EPI$$INSTANCE
		                                       WHERE ORACLE_SID = #hostname2#)) AA,
		                 (  SELECT B.INST_NO,
		                           B.TABLESPACE_NAME,
		                           MAX (B.LOGTIME) MAX_LOGTIME
		                      FROM DPM.EPI$$TABLESPACE_USAGE B
		                     WHERE B.INST_NO = (SELECT INST_NO
		                                          FROM DPM.EPI$$INSTANCE
		                                         WHERE ORACLE_SID = #hostname2#)
		                  GROUP BY B.INST_NO, B.TABLESPACE_NAME) BB
		           WHERE AA.INST_NO = BB.INST_NO
		             AND AA.TABLESPACE_NAME = BB.TABLESPACE_NAME
		             AND AA.LOGTIME = BB.MAX_LOGTIME
		        ORDER BY USED_PERCENT DESC) TS
		 WHERE ROWNUM < 3
		 
		UNION ALL
		
		SELECT #hostname3# HOSTNAME,
		       ROWNUM,
		       TS.INST_NO,
		       TS.LOGTIME,
		       TS.TABLESPACE_NAME,
		       TS.USED_PERCENT
		  FROM (  SELECT AA.INST_NO,
		                 AA.LOGTIME,
		                 AA.TABLESPACE_NAME,
		                 AA.USED_PERCENT
		            FROM (SELECT A.INST_NO,
		                         A.LOGTIME,
		                         A.TABLESPACE_NAME,
		                         A.USED_PERCENT
		                    FROM DPM.EPI$$TABLESPACE_USAGE A
		                   WHERE A.INST_NO = (SELECT INST_NO
		                                        FROM DPM.EPI$$INSTANCE
		                                       WHERE ORACLE_SID = #hostname3#)) AA,
		                 (  SELECT B.INST_NO,
		                           B.TABLESPACE_NAME,
		                           MAX (B.LOGTIME) MAX_LOGTIME
		                      FROM DPM.EPI$$TABLESPACE_USAGE B
		                     WHERE B.INST_NO = (SELECT INST_NO
		                                          FROM DPM.EPI$$INSTANCE
		                                         WHERE ORACLE_SID = #hostname3#)
		                  GROUP BY B.INST_NO, B.TABLESPACE_NAME) BB
		           WHERE AA.INST_NO = BB.INST_NO
		             AND AA.TABLESPACE_NAME = BB.TABLESPACE_NAME
		             AND AA.LOGTIME = BB.MAX_LOGTIME
		        ORDER BY USED_PERCENT DESC) TS
		 WHERE ROWNUM < 3
		 
		UNION ALL
		
		SELECT #hostname4# HOSTNAME,
		       ROWNUM,
		       TS.INST_NO,
		       TS.LOGTIME,
		       TS.TABLESPACE_NAME,
		       TS.USED_PERCENT
		  FROM (  SELECT AA.INST_NO,
		                 AA.LOGTIME,
		                 AA.TABLESPACE_NAME,
		                 AA.USED_PERCENT
		            FROM (SELECT A.INST_NO,
		                         A.LOGTIME,
		                         A.TABLESPACE_NAME,
		                         A.USED_PERCENT
		                    FROM DPM.EPI$$TABLESPACE_USAGE A
		                   WHERE A.INST_NO = (SELECT INST_NO
		                                        FROM DPM.EPI$$INSTANCE
		                                       WHERE ORACLE_SID = #hostname4#)) AA,
		                 (  SELECT B.INST_NO,
		                           B.TABLESPACE_NAME,
		                           MAX (B.LOGTIME) MAX_LOGTIME
		                      FROM DPM.EPI$$TABLESPACE_USAGE B
		                     WHERE B.INST_NO = (SELECT INST_NO
		                                          FROM DPM.EPI$$INSTANCE
		                                         WHERE ORACLE_SID = #hostname4#)
		                  GROUP BY B.INST_NO, B.TABLESPACE_NAME) BB
		           WHERE AA.INST_NO = BB.INST_NO
		             AND AA.TABLESPACE_NAME = BB.TABLESPACE_NAME
		             AND AA.LOGTIME = BB.MAX_LOGTIME
		        ORDER BY USED_PERCENT DESC) TS
		 WHERE ROWNUM < 3
		]]>
    </select>

    <select id="ifcDbDAO.mainBigData1Ajax" parameterClass="ifcDbVO" resultClass="ifcDbVO">
        /* mainBigData1Ajax 조회 */
        SELECT B.HOSTNAME,
               A.DISK,
               A.CPU,
               A.MEM MEMORY,
               A.INST_DATE,
               A.CRE_DATE
          FROM IOC_SDTIC_IFC_COLCT_DATA A,
               IOC_SDTIC_IFC_HOSTNAME_COLCT B
         WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
           AND B.HOSTNAME = #hostname#		/* cclwas034 */
           AND ROWNUM = 1
         ORDER BY INST_DATE DESC
    </select>
    
    <select id="ifcDbDAO.mainBigData2Ajax" parameterClass="ifcDbVO" resultClass="ifcDbVO">
        /* mainBigData2Ajax 조회 */
        SELECT B.HOSTNAME,
               A.DISK,
               A.CPU,
               A.MEM MEMORY,
               A.INST_DATE,
               A.CRE_DATE
          FROM IOC_SDTIC_IFC_COLCT_DATA A,
               IOC_SDTIC_IFC_HOSTNAME_COLCT B
         WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
           AND B.HOSTNAME = #hostname#		/* cclwas035 */
           AND ROWNUM = 1
         ORDER BY INST_DATE DESC
    </select>

    <select id="ifcDbDAO.mainDatabaseAjax" parameterClass="ifcDbVO" resultClass="ifcDbVO">
        /* mainDatabaseAjax 조회 */
        SELECT AA.GUBUN,
               AA.GROUP1,
               AA.GROUP2,
               BB.INST_DATE,
               BB.DISK,
               BB.CPU,
               BB.MEM MEMORY,
               (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND CODE_LEVEL = 2) GROUP1_NAME,
               (SELECT CODE_NAME FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_NAME,
               (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND CODE_LEVEL = 2) GROUP1_ORDER,
               (SELECT CODE_ORDER FROM IOC_SDTIC_IFC_CODE WHERE GUBUN = AA.GUBUN AND GROUP1 = AA.GROUP1 AND GROUP2 = AA.GROUP2) GROUP2_ORDER
          FROM IOC_SDTIC_IFC_HOSTNAME AA,
               (SELECT A.REAL_HOSTNAME,
                       MAX(A.DISK) DISK,
                       MAX(A.CPU) CPU,
                       MAX(A.MEM) MEM,
                       MAX(A.INST_DATE) INST_DATE
                  FROM (SELECT REAL_HOSTNAME,
                               DISK,
                               CPU,
                               MEM,
                               INST_DATE
                          FROM IOC_SDTIC_IFC_COLCT_DATA) A,
                       (SELECT REAL_HOSTNAME, MAX (INST_DATE) MAX_INST_DATE
                          FROM IOC_SDTIC_IFC_COLCT_DATA
                         GROUP BY (REAL_HOSTNAME)) B
                         WHERE A.REAL_HOSTNAME = B.REAL_HOSTNAME
                           AND A.INST_DATE = B.MAX_INST_DATE
                           AND A.REAL_HOSTNAME IN (SELECT T.REAL_HOSTNAME
	                                                 FROM IOC_SDTIC_IFC_HOSTNAME H,
	                                                      IOC_SDTIC_IFC_HOSTNAME_COLCT T
	                                                WHERE H.HOSTNAME = T.HOSTNAME
	                                                  AND H.GUBUN = #gubun#		/* DB */
	                                                  AND H.GROUP1 = #group1#	/* DBM */
                                                  )
                 GROUP BY A.REAL_HOSTNAME
               ) BB,
               IOC_SDTIC_IFC_HOSTNAME_COLCT CC
         WHERE AA.HOSTNAME = CC.HOSTNAME
           AND CC.REAL_HOSTNAME = BB.REAL_HOSTNAME
           AND AA.GUBUN = #gubun#		/* DB */
           AND AA.GROUP1 = #group1#		/* DBM */
         ORDER BY GROUP1_ORDER, GROUP2_ORDER
    </select>

</sqlMap>