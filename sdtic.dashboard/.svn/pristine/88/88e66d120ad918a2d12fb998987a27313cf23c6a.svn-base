<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ifcRlay">

    <typeAlias  alias="egovMap"   type="egovframework.rte.psl.dataaccess.util.EgovMap"  />
    <typeAlias  alias="ifcRlayVO"  type="egovframework.com.sdtic.ifcrs.service.IfcRlayVO" />

    <select id="ifcRlayDAO.ifcRlayServerAjax" parameterClass="ifcRlayVO" resultClass="ifcRlayVO">
        /* ifcRlayServerAjax 조회 */
        SELECT A.GUBUN,
               A.GROUP1,
               A.GROUP2,
               A.CRE_DATETIME,
               A.CPU,
               A.MEMORY,
               A.DISK,
               (SELECT CODE_NAME FROM IFC_CODE WHERE A.GUBUN = GUBUN AND A.GROUP1 = GROUP1 AND CODE_LEVEL = 2 ) GROUP1_NAME,
               (SELECT CODE_NAME FROM IFC_CODE WHERE A.GUBUN = GUBUN AND A.GROUP1 = GROUP1 AND A.GROUP2 = GROUP2 ) GROUP2_NAME,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE A.GUBUN = GUBUN AND A.GROUP1 = GROUP1 AND CODE_LEVEL = 2 ) GROUP1_ORDER,
               (SELECT CODE_ORDER FROM IFC_CODE WHERE A.GUBUN = GUBUN AND A.GROUP1 = GROUP1 AND A.GROUP2 = GROUP2 ) GROUP2_ORDER
          FROM (SELECT GUBUN,
                       GROUP1,
                       GROUP2,
                       CRE_DATETIME,
                       CPU,
                       MEMORY,
                       DISK
                  FROM IFC_SERVER_STATE) A,
               (  SELECT GUBUN,
                         GROUP1,
                         GROUP2,
                         MAX (CRE_DATETIME) MAX_CRE_DATETIME
                    FROM IFC_SERVER_STATE
                GROUP BY (GUBUN, GROUP1, GROUP2)) B
         WHERE A.GUBUN = B.GUBUN
           AND A.GROUP1 = B.GROUP1
           AND A.GROUP2 = B.GROUP2
           AND A.CRE_DATETIME = B.MAX_CRE_DATETIME
       <isNotEmpty property="gubun">
           <![CDATA[
           AND A.GUBUN = #gubun#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group1">
           <![CDATA[
           AND A.GROUP1 = #group1#
           ]]>
       </isNotEmpty>
       <isNotEmpty property="group2">
           <![CDATA[
           AND A.GROUP2 = #group2#
           ]]>
       </isNotEmpty>
         ORDER BY GROUP1_ORDER, GROUP2_ORDER
    </select>
</sqlMap>