<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<!DOCTYPE html>
<html lang="ko" class="cnt_if">
	<head>
	<meta charset="utf-8" />
	<title>업무별 인프라 관제</title>
	<!-- including ECharts file -->
	    <c:set var="contextPath" value="${pageContext.request.contextPath}" />
	    
	    <link rel="stylesheet" type="text/css" href="${contextPath}/css/main/default.css" />
	
	    <script type="text/javascript" src="${contextPath}/js/common/jquery-2.1.4.min.js"></script>
	    <script type="text/javascript" src="${contextPath}/js/echarts/dist/echarts.min.js"></script>
	
		<script type="text/javascript" src="${contextPath}/js/main/common.js"></script>
	    <script type="text/javascript" src="${contextPath}/js/echarts/theme/dark.js"></script>
	    <script type="text/javascript" src="${contextPath}/js/ifcrs/IfcUnitView.js"></script>
	    
	    <style type="text/css">
			#menu {position:absolute;top:20px;left:19px;}
			#legend {position:absolute;top:120px;left:10px;}
			#button {position:absolute;top:120px;left:1750px;}
			#grid1 {border:1px solid #666;position:absolute;top:160px;left:20px;background-color:#000;}
			#grid2 {border:1px solid #666;position:absolute;top:160px;left:475px;background-color:#000;}
			#grid3 {border:1px solid #666;position:absolute;top:160px;left:930px;background-color:#000;}
			#grid4 {border:1px solid #666;position:absolute;top:160px;left:1385px;background-color:#000;}
			#grid5 {border:1px solid #666;position:absolute;top:430px;left:20px;background-color:#000;}
			#grid6 {border:1px solid #666;position:absolute;top:430px;left:475px;background-color:#000;}
			#grid7 {border:1px solid #666;position:absolute;top:430px;left:930px;background-color:#000;}
			#grid8 {border:1px solid #666;position:absolute;top:430px;left:1385px;background-color:#000;}
			#grid9 {border:1px solid #666;position:absolute;top:700px;left:20px;background-color:#000;}
			#grid10 {border:1px solid #666;position:absolute;top:700px;left:475px;background-color:#000;}
			#event {border:1px solid #666;position:absolute;top:700px;left:930px;background-color:#000;}
			
			.areaLstBiz{overflow:hidden;width:1808px;height:82px;margin-bottom:10px;*zoom:1;}
			.areaLstBiz:after{content:"";display:block;clear:both;}
			.areaLstBiz li{overflow:hidden;float:left;width:224px;height:100%;margin:0 1px;}
			.areaLstCtrl{height:24px;margin-bottom:10px;*zoom:1;}
			.areaLstCtrl:after{content:"";display:block;clear:both;}
			.areaLstCtrl ul{float:right;}
			.areaLstCtrl li{float:left;margin-left:8px;}
			.tpSttCntn{width:240px;margin:0 auto;}
		</style>
		
	    <script type="text/javascript">
            $(window).load(function(){
            	//initMenu();
                initData();
                fn_menuRotation();
            });
        </script>
	</head>
	
	<body style="background-color:#171a1f;">
		<input type="hidden" id="selMenu" value="" />
		<input type="hidden" id="isRotation" value="" />
		
		<div id="menu" class="areaLstBiz">
			<ul>
				<li><img id="imgEXD" src="${contextPath}/images/ifcrs/biz01_on.png" alt="설계" style="cursor:pointer;" onclick="fn_selMenu('EXD','N');" /></li>
				<li><img id="imgCPM" src="${contextPath}/images/ifcrs/biz02.png" alt="건설" style="cursor:pointer;" onclick="fn_selMenu('CPM','N');" /></li>
				<li><img id="imgCNK" src="${contextPath}/images/ifcrs/biz03.png" alt="지식" style="cursor:pointer;" onclick="fn_selMenu('CNK','N');" /></li>
				<li><img id="imgEXM" src="${contextPath}/images/ifcrs/biz04.png" alt="도로관리" style="cursor:pointer;" onclick="fn_selMenu('EXM','N');" /></li>
				<li><img id="imgAFM" src="${contextPath}/images/ifcrs/biz05.png" alt="부대시설" style="cursor:pointer;" onclick="fn_selMenu('AFM','N');" /></li>
				<li><img id="imgSTM" src="${contextPath}/images/ifcrs/biz06.png" alt="구조물" style="cursor:pointer;" onclick="fn_selMenu('STM','N');" /></li>
				<li><img id="imgDSM" src="${contextPath}/images/ifcrs/biz07.png" alt="재난관리" style="cursor:pointer;" onclick="fn_selMenu('DSM','N');" /></li>
				<li><img id="imgTRS" src="${contextPath}/images/ifcrs/biz08.png" alt="교통안내" style="cursor:pointer;" onclick="fn_selMenu('TRS','N');" /></li>
			</ul>
		</div>
		<div id="legend" class="areaLstCtrl">
			<ul>
				<li><img id="imgEXD" src="${contextPath}/images/ifcrs/unitLegend.png" /></li>
			</ul>
		</div>
		<div id="button" class="areaLstCtrl">
			<ul>
				<li>
					<a href="#" onclick="fn_menuRotation()"><img id="rotIcon" src="${contextPath}/images/ifcrs/btn_stop.png" alt="정지" /></a>
				</li>
				<li>
					<a href="#" onclick="fn_unitSetup();"><img src="${contextPath}/images/ifcrs/btn_set.png" alt="설정" /></a>
				</li>
			</ul>
		</div>
		
	    <div id="grid1" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title1" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main1" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con1" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="grid2" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title2" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main2" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con2" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="grid3" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title3" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main3" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con3" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="grid4" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title4" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main4" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con4" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<div id="grid5" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title5" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main5" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con5" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="grid6" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title6" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main6" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con6" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="grid7" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title7" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main7" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con7" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="grid8" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title8" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main8" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con8" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<div id="grid9" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title9" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main9" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con9" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="grid10" style="width:435px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="title10" width="401px" class="titS">
						&nbsp;
						</th>
					</tr>
					<tr>
						<td>
						<div id="main10" style="width:395px;height:100px;"></div>
						</td>
					</tr>
					<tr>
						<td>
						<table id="con10" class="tblWgt tp02 tpSttCntn"></table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="event" style="width:890px;height:250px;">
	    	<table class="tblWgt tp03">
				<tbody>
					<tr>
						<th id="eventTitle" width="890px" class="titS">
						이벤트
						</th>
					</tr>
					<tr>
						<td>
						<table id="con10" border="1" class="tblWgt tp03" style="width:100%;border:solid 1px #444;">
							<colgroup>
								<col width="25%">
								<col width="20%">
								<col width="10%">
								<col width="10%">
								<col width="35%">
							</colgroup>
							<tbody id="eventTbody">
								<tr>
									<th scope="row" class="titS">발생일시</th>
									<th scope="row" class="titS">호스트명</th>
									<th scope="row" class="titS">등급</th>
									<th scope="row" class="titS">상태</th>
									<th scope="row" class="titS">이벤트 메세지</th>
								<tr>
							</tbody>
								
						</table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	    
	    <script type="text/javascript">
		    var myChart1;
		    var myChart2;
		    var myChart3;
		    var myChart4;
		    var myChart5;
		    var myChart6;
		    var myChart7;
		    var myChart8;
		    var myChart9;
		    var myChart10;
		    
		    var option1 = {};
		    var option2 = {};
		    var option3 = {};
		    var option4 = {};
		    var option5 = {};
		    var option6 = {};
		    var option7 = {};
		    var option8 = {};
		    var option9 = {};
		    var option10 = {};
		    
		    var data1 = new Array();
		    var data2 = new Array();
		    var data3 = new Array();
		    var data4 = new Array();
		    var data5 = new Array();
		    var data6 = new Array();
		    var data7 = new Array();
		    var data8 = new Array();
		    var data9 = new Array();
		    var data10 = new Array();
		    
		    function Request(){	
		    	var requestParam = "";	
		            this.getParameter = function(param){	
		        	var url = unescape(location.href);	
		            var paramArr = (url.substring(url.indexOf("?")+1,url.length)).split("&");	
		            for(var i = 0 ; i < paramArr.length ; i++){	
		                var temp = paramArr[i].split("=");
		                if(temp[0].toUpperCase() == param.toUpperCase()){
		                	requestParam = paramArr[i].split("=")[1];
		                    break;
		                }
		            }
		            return requestParam;
		        };
		    }
		    
		    var request = new Request();
		    $("#selMenu").val(request.getParameter("selMenu"));
		    $("#isRotation").val(request.getParameter("isRotation"));

		    var menu = ['EXD','CPM','CNK','EXM','AFM','STM','DSM','TRS'];
		    var menuText = ['설계','건설','지식','도로관리','부대시설','구조물','재난관리','교통안전'];
		    var gubun = new Array();
		    var gubun_name = new Array();
	    	
	    	if($("#selMenu").val().length < 1){
	    		$("#selMenu").val("EXD");
	    	}
	    	if($("#isRotation").val().length < 1){
	    		$("#isRotation").val("Y");
	    	}
	    	
	    	for(var i=0;i<menu.length;i++){
   				if($("#selMenu").val() == menu[i]){
   					$("#img"+menu[i]).attr("src", "${contextPath}/images/ifcrs/biz0"+(i+1)+"_on.png");
   				}else{
   					$("#img"+menu[i]).attr("src", "${contextPath}/images/ifcrs/biz0"+(i+1)+".png");
   				}
	    	}
	    	
	    	var chkStyle = /\d/;
	    	var widgetTimer = 60000 * 10;	//10분
	    	var paramWidgetTimer = "${param.widgetTimer}";
	    	if(paramWidgetTimer != null){
	    		if(chkStyle.test(paramWidgetTimer)){
	    			if(paramWidgetTimer != 0){
	    				widgetTimer = paramWidgetTimer;
	    			}
	    		}
	    	}
	    	
	    	var menuTimeTicketRun;
	    	
	    	function fn_startMenu(){
	    		menuTimeTicketRun = setInterval(function (){
		        	var menu_tmp = "";
		        	var cnt = 0;
		        	for(var i=0;i<menu.length;i++){
		        		if($("#selMenu").val() == menu[i]){
		        			cnt = i + 1;
		        			if(cnt == menu.length){
		        				cnt = 0;
		        			}
		        			menu_tmp = menu[cnt];
		        		}
		        	}
		        	fn_selMenu(menu_tmp, 'Y');
	            }, widgetTimer);
	    	}
	    	
	    	function fn_stopMenu(){
	    		clearInterval(menuTimeTicketRun);
	    	}
	    	
	    	function fn_menuRotation(){
	    		if($("#isRotation").val() == "Y"){
	    			$("#isRotation").val("N");
	    			$("#rotIcon").attr("src","${contextPath}/images/ifcrs/btn_stop.png");
	    			$("#rotIcon").attr("title","정지");
	    			fn_startMenu();
	    		}else{
	    			$("#isRotation").val("Y");
	    			$("#rotIcon").attr("src","${contextPath}/images/ifcrs/btn_play.png");
	    			$("#rotIcon").attr("title","시작");
	    			fn_stopMenu();
	    		}
	    	}

			function fn_selMenu(menu, isRotation){
	        	if(menu != ""){
	        		location.href = "${pageContext.request.contextPath}/ifc/ifcUnitView.do?selMenu="+menu+"&isRotation="+isRotation;
	        		return false;
	        	}
	        }
	        
	        function initData(){
                $.ajax({
                    url : '${pageContext.request.contextPath}/ifc/ifcUnit.do',
                    async : false,
                    dataType : 'json',
                    data:{
                        'unit'    : $("#selMenu").val(),
                        'rownum'  : 5
                    },
                    success :function(json) {
                    	var cnt = 0;
                    	var data_cnt = 0;
                    	var gubun_tmp = "";
                    	
                    	for(var i=0;i<json.data.length;i++){
                        	if(gubun_tmp != json.data[i].gubun){
                        		gubun[cnt] = json.data[i].gubun;
                        		gubun_tmp = json.data[i].gubun;
                        		cnt++;
                        		data_cnt = 0;
                        		
                        		//타이틀 세팅
                            	$("#title" + cnt).html(json.data[i].gubun_name);
                        	}
                        	
                        	if(json.data[i].server_gubun == "WAS" || json.data[i].server_gubun == "WEB"){
                        		var data_tmp = eval("data" + cnt);
                        		data_tmp[data_cnt] = [json.data[i].hostname, json.data[i].disk, json.data[i].cpu, json.data[i].memory];
                        		data_cnt++;
                        	}
                        	
                        	if(json.data[i].server_gubun == "CON"){
                        		var tagetId = "con" + cnt;
                   				var target = document.getElementById(tagetId);
                   				
                   				var tr = document.createElement("TR");
                   				var th = document.createElement("TH");
                   				th.innerHTML =  json.data[i].hostname;
                   				tr.appendChild(th);
                   				var td = document.createElement("TD");
                   				td.style.textAlign = "center";
                   				var img = document.createElement("IMG");
                   				if(json.data[i].con_yn == "Y"){
                   					img.src = "${contextPath}/images/ifcrs/icoNmlBgCb.png";
                   				}else{
                   					img.src = "${contextPath}/images/ifcrs/icoPrbBgCb.png";
                   				}
                                td.appendChild(img);
                   				tr.appendChild(td);
                   				target.appendChild(tr);
                        	}
                    	}
                    	
                    	for(var i=1;i<=gubun.length;i++){
                    		var myChart_tmp = eval("myChart" + i);
                    		var option_tmp = eval("option" + i);
                    		var data_tmp = eval("data" + i);
                    		
                    		myChart_tmp = echarts.init(document.getElementById("main" + i), 'dark');
                    		option_tmp = {
                               	color: [diskColor, '#fff', cpuColor, '#fff', memoryColor, '#fff'],
                                   legend: [{
                                       show: false,
                                       x : 'center',
                                       y : 'top',
                                       data: ['DISK', 'CPU', 'MEMORY']
                                   }],
                                   series: createSeries(data_tmp)
                               }
                    		myChart_tmp.setOption(option_tmp);
                    	}
                    	
                    	//이벤트
                    	for(var i=0;i<json.eventData.length;i++){
	           				var target = document.getElementById("eventTbody");
	           				var tr = document.createElement("TR");
	           				var td = document.createElement("TD");
	           				td.style.textAlign = "center";
	           				td.style.padding = "6px 15px 5px 15px"
	           				td.innerHTML = json.eventData[i].inst_date;
	           				tr.appendChild(td);
	           				var td = document.createElement("TD");
	           				td.style.textAlign = "center";
	           				td.style.padding = "7px 15px 6px 15px"
	           				td.innerHTML = json.eventData[i].hostname;
	           				tr.appendChild(td);
	           				var td = document.createElement("TD");
	           				td.style.textAlign = "center";
	           				td.style.padding = "7px 15px 6px 15px"
	           				td.innerHTML = json.eventData[i].troblgradse + "등급";
	           				tr.appendChild(td);
	           				var td = document.createElement("TD");
	           				td.style.textAlign = "center";
	           				td.style.padding = "7px 15px 6px 15px"
	           				td.innerHTML = json.eventData[i].troblprocesssttus;
	           				tr.appendChild(td);
	           				var td = document.createElement("TD");
	           				td.style.textAlign = "left";
	           				td.style.padding = "7px 15px 6px 15px"
	           				td.innerHTML = json.eventData[i].troblcn;
	           				tr.appendChild(td);
	           				target.appendChild(tr);
                    	}
                    },error : function(){
                        console.log(arguments);
                    }
                });
            }
	        
	        function fn_unitSetup(){
	        	var url = "${pageContext.request.contextPath}/ifc/ifcUnitSetupView.do";
	        	var name = "unitSetup";
	        	var width = 1000;
	        	var height = 600;
	        	var opt = "";
	        	
	        	WinPop(url, name, width, height, opt);
	        }
	    </script>
	</body>
</html>